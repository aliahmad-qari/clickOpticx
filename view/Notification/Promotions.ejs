<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Promotions Management</title>
  
  <!-- CSS Libraries -->
    <link rel="stylesheet" href="/vendors/feather/feather.css">
  <link rel="stylesheet" href="/vendors/ti-icons/css/themify-icons.css">
  <link rel="stylesheet" href="/vendors/css/vendor.bundle.base.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <!-- endinject -->
  <!-- Plugin css for this page -->
  <link rel="stylesheet" href="/vendors/datatables.net-bs4/dataTables.bootstrap4.css">
  <link rel="stylesheet" href="/vendors/ti-icons/css/themify-icons.css">
  <link rel="stylesheet" type="text/css" href="/js/select.dataTables.min.css">
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <link rel="stylesheet" href="/css/vertical-layout-light/style.css">
  <!-- endinject -->
  <link rel="shortcut icon" href="/images/favicon.png" />

  <!-- Material Design Icons CSS -->
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap CSS (single version) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<style>
  :root {
    --primary: #4f46e5;
    --primary-light: #6366f1;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --dark: #1f2937;
    --gray-50: #f9fafb;
    --gray-100: #f3f4f6;
    --gray-200: #e5e7eb;
    --gray-300: #d1d5db;
    --gray-500: #6b7280;
    --gray-700: #374151;
    --gray-900: #111827;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Inter', sans-serif;
    background: var(--gray-50);
    color: var(--gray-900);
    line-height: 1.6;
  }

  .main-panel {
    flex-grow: 1;
    padding: 20px;
  }

  @media (max-width: 991px) {
    .main-panel {
      margin-left: 0;
      padding: 10px;
    }
  }

  /* Professional Header */
  .promotion-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    color: white;
    padding: 2rem 0;
    margin-bottom: 2rem;
    border-radius: 0 0 20px 20px;
    box-shadow: 0 10px 30px rgba(79, 70, 229, 0.2);
  }

  .header-content {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
    text-align: center;
  }

  .header-title {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .header-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
  }

  /* Success Message */
  .success-message {
    background: linear-gradient(135deg, var(--success), #059669);
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 12px;
    margin-bottom: 2rem;
    border-left: 4px solid #065f46;
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.2);
    animation: slideIn 0.5s ease-out;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Main Container */
  .promotion-container {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    border: 1px solid var(--gray-200);
    overflow: hidden;
    margin-bottom: 2rem;
  }

  .container-header {
    background: var(--gray-50);
    padding: 1.5rem 2rem;
    border-bottom: 1px solid var(--gray-200);
  }

  .container-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--dark);
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .container-body {
    padding: 2rem;
  }

  /* Upload Section */
  .upload-section {
    background: var(--gray-50);
    border: 2px dashed var(--gray-300);
    border-radius: 12px;
    padding: 2rem;
    text-align: center;
    margin-bottom: 2rem;
    transition: all 0.3s ease;
  }

  .upload-section:hover {
    border-color: var(--primary);
    background: rgba(79, 70, 229, 0.02);
  }

  .upload-container {
    position: relative;
    max-width: 500px;
    margin: 0 auto;
  }

  .upload-area {
    position: relative;
    width: 100%;
    height: 300px;
    border-radius: 12px;
    overflow: hidden;
    background: var(--gray-100);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .upload-area:hover {
    background: var(--gray-200);
  }

  .upload-placeholder {
    text-align: center;
    color: var(--gray-500);
  }

  .upload-placeholder i {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: var(--gray-400);
  }

  .upload-placeholder h6 {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .upload-placeholder p {
    font-size: 0.9rem;
    margin: 0;
  }

  .upload-input {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
  }

  .preview-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 12px;
  }

  .remove-button {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 32px;
    height: 32px;
    background: var(--danger);
    color: white;
    border: none;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
    transition: all 0.2s ease;
    z-index: 10;
  }

  .remove-button:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
  }

  /* Form Fields */
  .form-section {
    margin-bottom: 2rem;
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-label {
    display: block;
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: 0.5rem;
    font-size: 0.95rem;
  }

  .form-control {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid var(--gray-200);
    border-radius: 8px;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    background: white;
  }

  .form-control:focus {
    border-color: var(--primary);
    outline: none;
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
  }

  /* Submit Button */
  .submit-section {
    text-align: center;
    margin-bottom: 2rem;
  }

  .btn-submit {
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    color: white;
    padding: 0.875rem 2rem;
    border: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 0 4px 15px rgba(79, 70, 229, 0.2);
  }

  .btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
  }

  .btn-submit:active {
    transform: translateY(0);
  }

  /* Existing Images Grid */
  .images-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 1rem;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 1px solid var(--gray-200);
  }

  .image-item {
    position: relative;
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
  }

  .image-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
  }

  .image-thumbnail {
    width: 100%;
    height: 80px;
    object-fit: cover;
  }

  .delete-form {
    position: absolute;
    top: 8px;
    right: 8px;
  }

  .btn-delete {
    width: 24px;
    height: 24px;
    background: rgba(239, 68, 68, 0.9);
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 0.75rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }

  .btn-delete:hover {
    background: var(--danger);
    transform: scale(1.1);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .header-title {
      font-size: 2rem;
    }
    
    .container-body {
      padding: 1.5rem;
    }

    .upload-area {
      height: 250px;
    }

    .upload-placeholder i {
      font-size: 2rem;
    }

    .images-grid {
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    }
  }

  /* Flatpickr custom styling */
  .flatpickr-input {
    background: white !important;
    position: relative;
    z-index: 10;
  }

  /* Hide the original ugly styling */
  .promo-3d-container,
  .promo-3d-upload-section,
  .promo-3d-upload-container {
    all: unset;
  }

  /* Dark Mode Support */
  [data-theme="dark"] body {
    background-color: #111827 !important;
    color: #F9FAFB !important;
  }

  [data-theme="dark"] .card {
    background-color: #1F2937 !important;
    color: #F9FAFB !important;
  }

  [data-theme="dark"] .table {
    background-color: #1F2937 !important;
    color: #F9FAFB !important;
  }

  [data-theme="dark"] .table th {
    background-color: #374151 !important;
    color: #F9FAFB !important;
    border-color: #4B5563 !important;
  }

  [data-theme="dark"] .table td {
    background-color: #1F2937 !important;
    color: #F9FAFB !important;
    border-color: #4B5563 !important;
  }

  [data-theme="dark"] .form-control {
    background-color: #4B5563 !important;
    color: #F9FAFB !important;
    border-color: #6B7280 !important;
  }

  [data-theme="dark"] .form-control:focus {
    background-color: #4B5563 !important;
    color: #F9FAFB !important;
    border-color: #8B5CF6 !important;
  }

  [data-theme="dark"] .btn-primary {
    background-color: #3B82F6 !important;
    border-color: #3B82F6 !important;
  }

  [data-theme="dark"] .btn-success {
    background-color: #10B981 !important;
    border-color: #10B981 !important;
  }

  [data-theme="dark"] .btn-danger {
    background-color: #DC2626 !important;
    border-color: #DC2626 !important;
  }

  [data-theme="dark"] .alert-primary {
    background-color: #1E40AF !important;
    border-color: #3B82F6 !important;
    color: #DBEAFE !important;
  }

  [data-theme="dark"] .modal-content {
    background-color: #1F2937 !important;
    color: #F9FAFB !important;
  }

  [data-theme="dark"] .modal-header {
    border-bottom-color: #4B5563 !important;
  }

  [data-theme="dark"] .modal-footer {
    border-top-color: #4B5563 !important;
  }
</style>

<body>
  <div class="container-scroller">
    <%- include('../partials/_navbar.ejs') %>
    
    <div class="container-fluid page-body-wrapper" style="padding-left: 0px; padding-right: 0px;">
      <%- include('../partials/SettingsDow.ejs') %>
      <%- include('../partials/Sidebar.ejs') %>
      
      <div class="main-panel" style="width: 100%;">
        <div class="content-wrapper">
          <!-- Professional Header -->
          <div class="promotion-header">
            <div class="header-content">
              <h1 class="header-title">
                <i class="fas fa-bullhorn me-3"></i>
                Promotions Management
              </h1>
              <p class="header-subtitle">
                Create and manage limited-time promotional offers for your users
              </p>
            </div>
          </div>

          <!-- Success Message -->
          <% if (messages.success) { %>
            <div class="success-message" id="success-message">
              <i class="fas fa-check-circle me-2"></i>
              <%= messages.success %>
            </div>
          <% } %>

          <!-- Main Container -->
          <div class="promotion-container">
            <div class="container-header">
              <h2 class="container-title">
                <i class="fas fa-plus-circle"></i>
                Add New Promotion
              </h2>
            </div>
            
            <div class="container-body">
              <form action="/Promotions" method="POST" enctype="multipart/form-data">
                <!-- Upload Section -->
                <div class="upload-section">
                  <div class="upload-container">
                    <div class="upload-area">
                      <div class="upload-placeholder" id="upload-placeholder">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h6>Upload Promotion Image</h6>
                        <p>Drag and drop an image here, or click to browse</p>
                      </div>
                      <input type="file" id="image-upload" name="img1" class="upload-input" accept="image/*" onchange="previewImage(event)" required>
                      <img id="preview-image" class="preview-image" style="display: none;" alt="Preview">
                      <button type="button" class="remove-button" id="remove-button" onclick="removeImage()" style="display: none;">
                        <i class="fas fa-times"></i>
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Form Section -->
                <div class="form-section">
                  <div class="form-group">
                    <label for="valid_till" class="form-label">
                      <i class="fas fa-calendar-alt me-2"></i>
                      Valid Until Date
                    </label>
                    <input type="text" id="valid_till" name="valid_till" class="form-control flatpickr-input" placeholder="Select expiration date" required readonly>
                  </div>
                </div>

                <!-- Submit Section -->
                <div class="submit-section">
                  <button type="submit" class="btn-submit">
                    <i class="fas fa-plus"></i>
                    <span>Create Promotion</span>
                  </button>
                </div>
              </form>

              <!-- Existing Promotions -->
              <% if (promotionresult && promotionresult.length > 0) { %>
                <div class="images-grid">
                  <% promotionresult.forEach((item) => { %>
                    <div class="image-item">
                      <img src="<%= item.img1.startsWith('http') ? item.img1 : '/uploads/' + item.img1 %>" alt="Promotion" class="image-thumbnail">
                      <form method="POST" action="/Promotions/delete/<%= item.id %>" class="delete-form" onsubmit="return confirm('Are you sure you want to delete this promotion?')">
                        <button type="submit" class="btn-delete">
                          <i class="fas fa-times"></i>
                        </button>
                      </form>
                    </div>
                  <% }) %>
                </div>
              <% } %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        crossorigin="anonymous"></script>

      <!-- Vendor and Custom Scripts -->
      <script src="/vendors/js/vendor.bundle.base.js"></script>
      <script src="/vendors/chart.js/Chart.min.js"></script>
      <script src="/vendors/datatables.net/jquery.dataTables.js"></script>
      <script src="/vendors/datatables.net-bs4/dataTables.bootstrap4.js"></script>
      <script src="/js/dataTables.select.min.js"></script>
      <script src="/js/off-canvas.js"></script>
      <script src="/js/hoverable-collapse.js"></script>
      <script src="/js/template.js"></script>
      <script src="/js/billing-payments-common.js"></script>
      <script src="/js/settings.js"></script>
      <script src="/js/dashboard.js"></script>
      <script src="/js/Chart.roundedBarCharts.js"></script>
      <!-- jQuery -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  
  
  <script>
    // Initialize Flatpickr
    flatpickr("#valid_till", {
      dateFormat: "Y-m-d",
      altInput: true,
      altFormat: "F j, Y",
      allowInput: true,
      minDate: "today",
      theme: "light"
    });

    // Image upload functionality
    function previewImage(event) {
      const input = event.target;
      const file = input.files[0];
      
      if (file) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
          const previewImg = document.getElementById('preview-image');
          const placeholder = document.getElementById('upload-placeholder');
          const removeBtn = document.getElementById('remove-button');
          
          previewImg.src = e.target.result;
          previewImg.style.display = 'block';
          placeholder.style.display = 'none';
          removeBtn.style.display = 'flex';
        };
        
        reader.readAsDataURL(file);
      }
    }

    function removeImage() {
      const input = document.getElementById('image-upload');
      const previewImg = document.getElementById('preview-image');
      const placeholder = document.getElementById('upload-placeholder');
      const removeBtn = document.getElementById('remove-button');
      
      input.value = '';
      previewImg.style.display = 'none';
      placeholder.style.display = 'block';
      removeBtn.style.display = 'none';
    }

    // Auto-hide success message
    document.addEventListener('DOMContentLoaded', function() {
      const successMessage = document.getElementById('success-message');
      if (successMessage) {
        setTimeout(() => {
          successMessage.style.transition = 'opacity 0.5s ease-out';
          successMessage.style.opacity = '0';
          setTimeout(() => {
            successMessage.style.display = 'none';
          }, 500);
        }, 4000);
      }
    });

    // Drag and drop functionality
    const uploadArea = document.querySelector('.upload-area');
    const fileInput = document.getElementById('image-upload');

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      uploadArea.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
      uploadArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
      uploadArea.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
      uploadArea.style.borderColor = 'var(--primary)';
      uploadArea.style.background = 'rgba(79, 70, 229, 0.05)';
    }

    function unhighlight(e) {
      uploadArea.style.borderColor = 'var(--gray-300)';
      uploadArea.style.background = 'var(--gray-100)';
    }

    uploadArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;
      
      fileInput.files = files;
      previewImage({ target: fileInput });
    }

    // Click to upload
    uploadArea.addEventListener('click', () => fileInput.click());
  </script>

</body>

</html>