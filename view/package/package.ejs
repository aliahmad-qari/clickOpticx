<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Packages</title>
    <link rel="stylesheet" href="/vendors/feather/feather.css">
    <link rel="stylesheet" href="/vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" href="/vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/vendors/datatables.net-bs4/dataTables.bootstrap4.css">
    <link rel="stylesheet" type="text/css" href="/js/select.dataTables.min.css">
    <link rel="stylesheet" href="/css/vertical-layout-light/style.css">
    <link rel="shortcut icon" href="/images/favicon.png" />
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
      /* Global Theme Variables */
      :root {
        /* Brand Colors - Same for both themes */
        --primary-color: #4F46E5;
        --primary-dark: #3730A3;
        --primary-light: #8B5CF6;
        --secondary-color: #10B981;
        --secondary-dark: #059669;
        --accent-color: #F59E0B;
        --accent-dark: #D97706;
        --danger-color: #EF4444;
        --success-color: #22C55E;
        --warning-color: #F59E0B;
        --info-color: #3B82F6;

        /* Light Theme Colors */
        --bg-primary: #FFFFFF;
        --bg-secondary: #F8FAFC;
        --bg-tertiary: #F1F5F9;
        --text-primary: #1E293B;
        --text-secondary: #475569;
        --text-tertiary: #64748B;
        --border-primary: #E2E8F0;
        --border-secondary: #CBD5E1;
        --shadow-light: rgba(0, 0, 0, 0.1);
        --shadow-medium: rgba(0, 0, 0, 0.15);
        --shadow-heavy: rgba(0, 0, 0, 0.25);
        --card-bg: #FFFFFF;
        --navbar-bg: #FFFFFF;
        --sidebar-bg: #FFFFFF;
      }

      /* Dark Theme Colors */
      [data-theme="dark"] {
        --bg-primary: #0F172A;
        --bg-secondary: #1E293B;
        --bg-tertiary: #334155;
        --text-primary: #F8FAFC;
        --text-secondary: #CBD5E1;
        --text-tertiary: #94A3B8;
        --border-primary: #334155;
        --border-secondary: #475569;
        --shadow-light: rgba(0, 0, 0, 0.3);
        --shadow-medium: rgba(0, 0, 0, 0.4);
        --shadow-heavy: rgba(0, 0, 0, 0.6);
        --card-bg: #1E293B;
        --navbar-bg: #0F172A;
        --sidebar-bg: #1E293B;
      }

      /* Legacy compatibility */
      :root {
        --primary: var(--primary-color);
        --primary-light: var(--primary-light);
        --secondary: var(--secondary-color);
        --success: var(--success-color);
        --success-light: var(--success-color);
        --warning: var(--warning-color);
        --danger: var(--danger-color);
        --dark: var(--text-primary);
        --light: var(--bg-secondary);
        --gray: var(--border-primary);
        --card-bg: var(--card-bg);
        --glass-effect: rgba(255, 255, 255, 0.15);
        
        /* Additional Variables for Package Cards */
        --radius-sm: 8px;
        --radius-md: 12px;
        --radius-lg: 16px;
        --radius-xl: 20px;
        --radius-2xl: 24px;
        --spacing-xs: 0.5rem;
        --spacing-sm: 0.75rem;
        --spacing-md: 1rem;
        --spacing-lg: 1.5rem;
        --spacing-xl: 2rem;
        --spacing-2xl: 3rem;
        --shadow-light: rgba(0, 0, 0, 0.1);
        --shadow-medium: rgba(0, 0, 0, 0.15);
        --shadow-heavy: rgba(0, 0, 0, 0.25);
      }

      /* Apply theme to body and main elements */
      body {
        background-color: var(--bg-secondary) !important;
        color: var(--text-primary) !important;
        transition: all 0.3s ease;
      }
      #manualPayBtn:hover {
  background: linear-gradient(90deg, var(--primary-dark), var(--primary-color));
  transform: translateY(-2px);
  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
  color: white;
}


      /* Main content card background */
      .main-content-card {
        background-color: var(--bg-secondary) !important;
        border: none !important;
        box-shadow: none !important;
      }

      /* Page body wrapper */
      .container-fluid.page-body-wrapper {
        background-color: var(--bg-secondary) !important;
      }

      /* Card-body inside main content */
      .main-content-card .card-body {
        background-color: var(--bg-secondary) !important;
        color: var(--text-primary) !important;
      }
  
      /* Package Cards Container */
      .package-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: var(--spacing-xl);
        margin-bottom: var(--spacing-2xl);
        background-color: transparent !important;
      }

      /* Ensure all Bootstrap cards use theme colors */
      .card {
        background-color: var(--card-bg) !important;
        border-color: var(--border-primary) !important;
        color: var(--text-primary) !important;
      }

      /* Main wrapper backgrounds */
      .container-scroller {
        background-color: var(--bg-secondary) !important;
      }

      .package-card {
        background: var(--card-bg) !important;
        border-radius: var(--radius-2xl);
        padding: 0;
        box-shadow: 0 10px 15px -3px var(--shadow-light), 0 4px 6px -2px var(--shadow-light);
        border: 2px solid var(--border-primary) !important;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      /* Ensure all package cards use theme colors */
      [data-theme="dark"] .package-card {
        background: var(--card-bg) !important;
        border-color: var(--border-primary) !important;
      }

      .package-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 50px -12px var(--shadow-medium);
      }

      /* Basic Plan - Blue Theme */
      .package-card:nth-child(1) {
        background: linear-gradient(135deg, #EBF4FF 0%, #DBEAFE 100%) !important;
        border: 2px solid #3B82F6 !important;
      }

      .package-card:nth-child(1):hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 50px -12px rgba(59, 130, 246, 0.4);
        border-color: #2563EB !important;
      }

      .package-card:nth-child(1)::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #3B82F6, #1D4ED8);
        border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
      }

      /* Dark theme overrides for Basic Plan */
      [data-theme="dark"] .package-card:nth-child(1) {
        background: var(--card-bg) !important;
        border: 2px solid var(--border-primary) !important;
      }

      [data-theme="dark"] .package-card:nth-child(1):hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 50px -12px var(--shadow-medium);
        border-color: var(--border-secondary) !important;
      }

      /* Standard Plan - Purple Theme (Featured) */
      .package-card.featured {
        background: linear-gradient(135deg, #F3E8FF 0%, #EDE9FE 100%) !important;
        border: 3px solid #8B5CF6 !important;
        transform: scale(1.02);
        box-shadow: 0 25px 50px -12px rgba(139, 92, 246, 0.3);
      }

      .package-card.featured:hover {
        transform: scale(1.02) translateY(-8px);
        box-shadow: 0 35px 60px -12px rgba(139, 92, 246, 0.5);
        border-color: #7C3AED !important;
      }

      .package-card.featured::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #8B5CF6, #7C3AED);
        border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
        z-index: 1;
      }

      /* Dark theme overrides for Featured Plan */
      [data-theme="dark"] .package-card.featured {
        background: var(--card-bg) !important;
        border: 2px solid var(--border-primary) !important;
      }

      [data-theme="dark"] .package-card.featured:hover {
        transform: scale(1.02) translateY(-8px);
        box-shadow: 0 25px 50px -12px var(--shadow-medium);
        border-color: var(--border-secondary) !important;
      }

      /* Premium Plan - Emerald Theme */
      .package-card:nth-child(3) {
        background: linear-gradient(135deg, #ECFDF5 0%, #D1FAE5 100%) !important;
        border: 2px solid #10B981 !important;
      }

      .package-card:nth-child(3):hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 50px -12px rgba(16, 185, 129, 0.4);
        border-color: #059669 !important;
      }

      .package-card:nth-child(3)::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #10B981, #059669);
        border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
      }

      /* Dark theme overrides for Premium Plan */
      [data-theme="dark"] .package-card:nth-child(3) {
        background: var(--card-bg) !important;
        border: 2px solid var(--border-primary) !important;
      }

      [data-theme="dark"] .package-card:nth-child(3):hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 50px -12px var(--shadow-medium);
        border-color: var(--border-secondary) !important;
      }

      .package-content {
        padding: var(--spacing-2xl);
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      .package-card.featured .package-content {
        padding-top: calc(var(--spacing-2xl) + var(--spacing-lg));
      }

      /* Popular Badge */
      .popular-badge {
        position: absolute;
        top: var(--spacing-lg);
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(135deg, #FDE047, #FACC15);
        color: #92400E;
        padding: var(--spacing-xs) var(--spacing-lg);
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 700;
        z-index: 2;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
      }

      /* Admin Badge */
      .admin-badge {
        position: absolute;
        top: var(--spacing-sm);
        right: var(--spacing-sm);
        z-index: 2;
      }

      .user-count-badge {
        background: var(--accent-color);
        color: white;
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--radius-lg);
        font-size: 0.85rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: var(--spacing-xs);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .package-tier {
        text-align: center;
        margin-bottom: var(--spacing-xl);
      }

      .package-title {
        font-size: 1.5rem;
        font-weight: 800;
        margin-bottom: var(--spacing-sm);
        text-transform: uppercase;
        letter-spacing: 0.8px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        color: var(--text-primary) !important;
      }

      /* Basic Plan Title */
      .package-card:nth-child(1) .package-title {
        color: #1E40AF !important;
      }

      /* Featured Plan Title */
      .package-card.featured .package-title {
        color: #6D28D9 !important;
      }

      /* Premium Plan Title */
      .package-card:nth-child(3) .package-title {
        color: #047857 !important;
      }

      /* Dark theme overrides for package titles */
      [data-theme="dark"] .package-card:nth-child(1) .package-title {
        color: #60A5FA !important;
      }

      [data-theme="dark"] .package-card.featured .package-title {
        color: #A78BFA !important;
      }

      [data-theme="dark"] .package-card:nth-child(3) .package-title {
        color: #34D399 !important;
      }

      /* For packages beyond the first 3 */
      .package-card:nth-child(n+4) .package-title {
        color: var(--text-primary) !important;
      }

      .tier-stars {
        font-size: 1.3rem;
        letter-spacing: 3px;
        margin-top: var(--spacing-xs);
      }

      /* Basic Plan Stars */
      .package-card:nth-child(1) .tier-stars {
        color: #3B82F6;
        filter: drop-shadow(0 2px 4px rgba(59, 130, 246, 0.3));
      }

      /* Featured Plan Stars */
      .package-card.featured .tier-stars {
        color: #FDE047;
        filter: drop-shadow(0 2px 6px rgba(253, 224, 71, 0.5));
      }

      /* Premium Plan Stars */
      .package-card:nth-child(3) .tier-stars {
        color: #10B981;
        filter: drop-shadow(0 2px 4px rgba(16, 185, 129, 0.3));
      }

      /* Dark theme - all packages use primary color for stars */
      [data-theme="dark"] .package-card:nth-child(1) .tier-stars {
        color: var(--primary-color) !important;
        filter: drop-shadow(0 2px 4px rgba(79, 70, 229, 0.3));
      }

      [data-theme="dark"] .package-card.featured .tier-stars {
        color: var(--primary-color) !important;
        filter: drop-shadow(0 2px 4px rgba(79, 70, 229, 0.3));
      }

      [data-theme="dark"] .package-card:nth-child(3) .tier-stars {
        color: var(--primary-color) !important;
        filter: drop-shadow(0 2px 4px rgba(79, 70, 229, 0.3));
      }

      .package-price-section {
        text-align: center;
        margin-bottom: var(--spacing-2xl);
        padding: var(--spacing-xl);
        border-radius: var(--radius-xl);
        border: 2px solid rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
      }

      /* Basic Plan Pricing */
      .package-card:nth-child(1) .package-price-section {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 197, 253, 0.2)) !important;
        border-color: rgba(59, 130, 246, 0.3) !important;
      }

      /* Featured Plan Pricing */
      .package-card.featured .package-price-section {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(196, 181, 253, 0.25)) !important;
        border-color: rgba(139, 92, 246, 0.4) !important;
        box-shadow: 0 8px 25px rgba(139, 92, 246, 0.2);
      }

      /* Premium Plan Pricing */
      .package-card:nth-child(3) .package-price-section {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(110, 231, 183, 0.2)) !important;
        border-color: rgba(16, 185, 129, 0.3) !important;
      }

      /* Dark theme pricing sections - same style for all */
      [data-theme="dark"] .package-card:nth-child(1) .package-price-section {
        background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(79, 70, 229, 0.05)) !important;
        border-color: rgba(79, 70, 229, 0.3) !important;
      }

      [data-theme="dark"] .package-card.featured .package-price-section {
        background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(79, 70, 229, 0.05)) !important;
        border-color: rgba(79, 70, 229, 0.3) !important;
      }

      [data-theme="dark"] .package-card:nth-child(3) .package-price-section {
        background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(79, 70, 229, 0.05)) !important;
        border-color: rgba(79, 70, 229, 0.3) !important;
      }

      .discount-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background: var(--danger-color);
        color: white;
        padding: var(--spacing-xs) var(--spacing-sm);
        border-radius: var(--radius-lg);
        font-size: 0.75rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 4px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .package-price {
        font-size: 3rem;
        font-weight: 900;
        line-height: 1;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: var(--spacing-sm);
        color: var(--text-primary) !important;
      }

      /* Basic Plan Price */
      .package-card:nth-child(1) .package-price {
        color: #1E40AF !important;
      }

      /* Featured Plan Price */
      .package-card.featured .package-price {
        color: #6D28D9 !important;
      }

      /* Premium Plan Price */
      .package-card:nth-child(3) .package-price {
        color: #047857 !important;
      }

      /* Dark theme overrides for package prices */
      [data-theme="dark"] .package-card:nth-child(1) .package-price {
        color: #60A5FA !important;
      }

      [data-theme="dark"] .package-card.featured .package-price {
        color: #A78BFA !important;
      }

      [data-theme="dark"] .package-card:nth-child(3) .package-price {
        color: #34D399 !important;
      }

      /* For packages beyond the first 3 */
      .package-card:nth-child(n+4) .package-price {
        color: var(--text-primary) !important;
      }

      .package-card:nth-child(n+4) {
        background: var(--card-bg) !important;
        border: 2px solid var(--border-primary) !important;
      }

      .package-card:nth-child(n+4):hover {
        transform: translateY(-8px);
        box-shadow: 0 25px 50px -12px var(--shadow-medium);
        border-color: var(--border-secondary) !important;
      }

      .package-card:nth-child(n+4)::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
        border-radius: var(--radius-2xl) var(--radius-2xl) 0 0;
      }

      .package-card:nth-child(n+4) .package-price-section {
        background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(79, 70, 229, 0.05)) !important;
        border-color: rgba(79, 70, 229, 0.3) !important;
      }

      .package-card:nth-child(n+4) .package-features li i {
        color: var(--primary-color) !important;
      }

      .package-card:nth-child(n+4) .tier-stars {
        color: var(--primary-color) !important;
        filter: drop-shadow(0 2px 4px rgba(79, 70, 229, 0.3));
      }

      /* Dark theme overrides for packages beyond first 3 */
      [data-theme="dark"] .package-card:nth-child(n+4) {
        background: var(--card-bg) !important;
        border: 2px solid var(--border-primary) !important;
      }

      [data-theme="dark"] .package-card:nth-child(n+4) .package-price-section {
        background: linear-gradient(135deg, var(--bg-tertiary), rgba(79, 70, 229, 0.1)) !important;
        border-color: rgba(79, 70, 229, 0.3) !important;
      }

      .package-price .period {
        font-size: 1.1rem;
        color: var(--text-secondary);
        font-weight: 600;
      }

      .original-price {
        display: block;
        font-size: 1.2rem;
        color: var(--text-tertiary);
        text-decoration: line-through;
        margin-top: var(--spacing-xs);
      }

      /* Status Badges */
      .status-badge {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        padding: var(--spacing-md);
        border-radius: var(--radius-lg);
        margin-bottom: var(--spacing-lg);
        font-size: 0.9rem;
        font-weight: 600;
      }

      .status-badge.active {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(34, 197, 94, 0.05));
        border: 1px solid rgba(34, 197, 94, 0.2);
        color: var(--success-color);
      }

      .status-badge.inactive {
        background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05));
        border: 1px solid rgba(245, 158, 11, 0.2);
        color: var(--warning-color);
      }

      .status-info {
        flex: 1;
      }

      .expiry-info {
        font-size: 0.8rem;
        opacity: 0.8;
        margin-top: 2px;
      }

      .package-features {
        list-style: none;
        padding: 0;
        margin-bottom: var(--spacing-2xl);
        flex-grow: 1;
      }

      .package-features li {
        display: flex;
        align-items: center;
        gap: var(--spacing-md);
        padding: var(--spacing-sm) 0;
        font-size: 0.95rem;
        color: var(--text-secondary);
      }

      .package-features li i {
        font-size: 1.1rem;
        flex-shrink: 0;
      }

      /* Basic Plan Features */
      .package-card:nth-child(1) .package-features li i {
        color: #3B82F6;
      }

      /* Featured Plan Features */
      .package-card.featured .package-features li i {
        color: #8B5CF6;
      }

      /* Premium Plan Features */
      .package-card:nth-child(3) .package-features li i {
        color: #10B981;
      }

      /* Dark theme - all packages use primary color for features */
      [data-theme="dark"] .package-card:nth-child(1) .package-features li i {
        color: var(--primary-color) !important;
      }

      [data-theme="dark"] .package-card.featured .package-features li i {
        color: var(--primary-color) !important;
      }

      [data-theme="dark"] .package-card:nth-child(3) .package-features li i {
        color: var(--primary-color) !important;
      }

      .package-features li span {
        font-weight: 500;
        color: var(--text-primary);
      }

      .package-footer {
        margin-top: auto;
      }

      .tax-info {
        text-align: center;
        font-size: 0.85rem;
        color: var(--text-tertiary);
        margin-bottom: var(--spacing-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-xs);
      }

      .package-actions {
        display: flex;
        justify-content: center;
      }

      .package-btn {
        width: 100%;
        padding: var(--spacing-lg) var(--spacing-xl);
        border: none;
        border-radius: 50px;
        font-weight: 700;
        font-size: 1.1rem;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--spacing-sm);
        text-decoration: none;
        position: relative;
        overflow: hidden;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .package-btn {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
      }

      .package-btn:hover {
        background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-color) 100%);
        box-shadow: 0 15px 35px rgba(79, 70, 229, 0.4);
        transform: translateY(-3px);
        color: white;
        text-decoration: none;
      }

      .package-btn i {
        font-size: 1.3rem;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
      }

      /* Admin Actions */
      .admin-actions {
        display: flex;
        gap: var(--spacing-sm);
        justify-content: center;
      }

      .admin-btn {
        width: 50px;
        height: 50px;
        border: none;
        border-radius: 50%;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .admin-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
      }

      .delete-btn {
        background: var(--danger-color);
      }

      .delete-btn:hover {
        background: #DC2626;
      }

      .edit-btn {
        background: var(--success-color);
      }

      .edit-btn:hover {
        background: #16A34A;
      }

      .discount-btn {
        background: var(--primary-color);
      }

      .discount-btn:hover {
        background: var(--primary-dark);
      }

      /* Mobile Responsive */
      /* Mobile Responsiveness for Home Collection */
      @media (max-width: 768px) {
        /* Payment option cards stack on mobile */
        .payment-option-card {
          margin-bottom: 1rem !important;
        }
        
        /* Home collection fields full width on mobile */
        #homeCollectionFields .col-md-6 {
          width: 100% !important;
          margin-bottom: 1rem;
        }
        
        /* Toast position adjustment for mobile */
        .mobile-toast {
          top: 10px !important;
          right: 10px !important;
          left: 10px !important;
          width: auto !important;
          font-size: 0.9rem;
        }
        
        /* Home collection card better mobile styling */
        .payment-option-card {
          padding: 1rem !important;
          text-align: center;
        }
        
        .payment-option-card h6 {
          font-size: 1rem !important;
        }
        
        .payment-option-card p {
          font-size: 0.8rem !important;
        }
      }

      @media (max-width: 768px) {
        .package-cards {
          grid-template-columns: 1fr;
          gap: var(--spacing-lg);
          margin: 0;
          padding: 0 var(--spacing-sm);
        }
        
        .package-card {
          margin: 0;
          min-height: auto;
        }
        
        .package-card.featured {
          transform: none;
          scale: 1;
        }
        
        .package-card.featured:hover {
          transform: translateY(-8px);
        }
        
        .package-content {
          padding: var(--spacing-lg);
        }
        
        .package-title {
          font-size: 1.3rem;
          line-height: 1.2;
          margin-bottom: var(--spacing-sm);
        }
        
        .package-price {
          font-size: 2.2rem;
          line-height: 1.1;
        }
        
        .package-price .period {
          font-size: 0.9rem;
        }
        
        .package-price-section {
          padding: var(--spacing-lg) var(--spacing-md);
        }
        
        .package-features {
          margin-bottom: var(--spacing-lg);
        }
        
        .package-features li {
          padding: var(--spacing-xs) 0;
          font-size: 0.9rem;
        }
        
        .status-badge {
          padding: var(--spacing-sm);
          font-size: 0.85rem;
        }
        
        .admin-actions {
          justify-content: space-around;
          flex-wrap: wrap;
        }
        
        .admin-btn {
          width: 48px;
          height: 48px;
          margin: 2px;
        }

        .user-count-badge {
          font-size: 0.8rem;
          padding: 4px 8px;
        }

        .popular-badge {
          font-size: 0.75rem;
          padding: 4px 12px;
        }
      }

      @media (max-width: 480px) {
        .package-cards {
          grid-template-columns: 1fr;
          gap: var(--spacing-md);
          margin: 0;
          padding: 0 var(--spacing-xs);
        }
        
        .package-card {
          margin: 0;
          border-radius: var(--radius-xl);
        }
        
        .package-content {
          padding: var(--spacing-md);
        }
        
        .package-title {
          font-size: 1.2rem;
          line-height: 1.2;
          margin-bottom: var(--spacing-xs);
          letter-spacing: 0.5px;
        }
        
        .tier-stars {
          font-size: 1.1rem;
          margin-top: var(--spacing-xs);
        }
        
        .package-price-section {
          padding: var(--spacing-md) var(--spacing-sm);
          margin: var(--spacing-sm) 0;
        }
        
        .package-price {
          font-size: 1.8rem !important;
          line-height: 1;
        }
        
        .package-price .period {
          font-size: 0.8rem;
        }
        
        .package-features {
          gap: var(--spacing-xs);
          margin: var(--spacing-sm) 0;
        }
        
        .package-features li {
          font-size: 0.85rem;
          padding: 4px 0;
        }
        
        .admin-actions {
          flex-wrap: wrap;
          gap: var(--spacing-xs);
          justify-content: center;
        }
        
        .admin-btn {
          width: 44px;
          height: 44px;
          font-size: 0.95rem;
        }

        .tax-info {
          font-size: 0.8rem;
          margin-bottom: var(--spacing-sm);
        }

        .package-btn {
          padding: var(--spacing-md) var(--spacing-lg);
          font-size: 1rem;
        }

        .status-badge {
          padding: var(--spacing-sm);
          font-size: 0.8rem;
          flex-direction: column;
          text-align: center;
        }

        .status-info {
          margin-top: var(--spacing-xs);
        }

        .expiry-info {
          font-size: 0.75rem;
        }

        .discount-badge {
          font-size: 0.7rem;
          padding: 2px 6px;
        }

        .user-count-badge {
          font-size: 0.75rem;
          padding: 2px 6px;
        }

        .popular-badge {
          font-size: 0.7rem;
          padding: 2px 8px;
        }
      }

      /* Boost Animation and Toast Styles */
      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
          transform: translateY(0);
        }
        to {
          opacity: 0;
          transform: translateY(-20px);
        }
      }

      @keyframes pulseGlow {
        0%, 100% {
          box-shadow: 0 0 20px rgba(34, 197, 94, 0.4);
        }
        50% {
          box-shadow: 0 0 40px rgba(34, 197, 94, 0.8);
        }
      }

      @keyframes boostProgress {
        0% { width: 0%; }
        100% { width: 100%; }
      }

      @keyframes numberCount {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }

      .boost-toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, var(--success-color), #16A34A);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: var(--radius-lg);
        box-shadow: 0 10px 25px rgba(34, 197, 94, 0.3);
        z-index: 9999;
        font-weight: 600;
        animation: slideInUp 0.4s ease-out;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .boost-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(8px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        animation: fadeIn 0.3s ease-out;
      }

      .boost-content {
        background: var(--card-bg);
        border-radius: var(--radius-2xl);
        padding: var(--spacing-2xl);
        max-width: 500px;
        width: 90%;
        text-align: center;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        border: 1px solid var(--border-primary);
        animation: slideInUp 0.4s ease-out;
      }

      .boost-icon {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, var(--success-color), #16A34A);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto var(--spacing-lg);
        font-size: 2.5rem;
        color: white;
        animation: pulseGlow 2s infinite;
      }

      .boost-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: var(--spacing-sm);
      }

      .boost-subtitle {
        color: var(--text-secondary);
        margin-bottom: var(--spacing-xl);
      }

      .boost-progress-container {
        background: var(--bg-tertiary);
        border-radius: 50px;
        height: 12px;
        margin-bottom: var(--spacing-lg);
        overflow: hidden;
        border: 1px solid var(--border-primary);
      }

      .boost-progress-bar {
        height: 100%;
        background: linear-gradient(135deg, var(--success-color), #16A34A);
        border-radius: 50px;
        animation: boostProgress 3s ease-in-out;
        box-shadow: 0 0 10px rgba(34, 197, 94, 0.5);
      }

      .boost-stats {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--spacing-lg);
        margin-bottom: var(--spacing-xl);
      }

      .boost-stat {
        background: var(--bg-tertiary);
        padding: var(--spacing-lg);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border-primary);
      }

      .boost-stat-value {
        font-size: 2rem;
        font-weight: 800;
        color: var(--success-color);
        animation: numberCount 0.6s ease-out 1.5s both;
      }

      .boost-stat-label {
        font-size: 0.9rem;
        color: var(--text-secondary);
        margin-top: var(--spacing-xs);
      }

      .boost-close-btn {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        color: white;
        border: none;
        padding: var(--spacing-md) var(--spacing-xl);
        border-radius: 50px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: var(--spacing-lg);
      }

      .boost-close-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
  
      /* form css - Fixed modal z-index and positioning issues */
      .modal {
        z-index: 9999 !important;
      }
  
      .modal-backdrop {
        z-index: 9998 !important;
        background-color: rgba(0, 0, 0, 0.5);
      }
  
      .modal-backdrop.show {
        opacity: 0.5;
      }

      /* Fix modal positioning to avoid navbar/footer overlap */
      .modal-dialog {
        margin: 60px auto !important;
        max-height: calc(100vh - 120px) !important;
      }

      .modal-content {
        max-height: calc(100vh - 140px) !important;
        overflow-y: auto !important;
      }

      /* Ensure modal doesn't get cut off on mobile */
      @media (max-width: 768px) {
        .modal-dialog {
          margin: 20px !important;
          max-height: calc(100vh - 40px) !important;
        }
        
        .modal-content {
          max-height: calc(100vh - 60px) !important;
        }

        /* Fix mobile placeholder text overflow */
        #customPaySection .form-control::placeholder,
        #homeCollectionFields .form-control::placeholder {
          font-size: 0.8rem !important;
          white-space: nowrap !important;
          overflow: hidden !important;
          text-overflow: ellipsis !important;
        }

        /* Shorten specific placeholders for mobile */
        #collection_address::placeholder {
          content: "Enter address" !important;
        }
        
        #contact_number::placeholder {
          content: "Contact number" !important;
        }
        
        #special_instructions::placeholder {
          content: "Special notes" !important;
        }

        /* Ensure form fields don't overflow on mobile */
        #customPaySection .form-control,
        #homeCollectionFields .form-control {
          font-size: 0.9rem !important;
          padding: 10px 12px 10px 40px !important;
        }
      }
  
      .form-card {
        background: var(--card-bg);
        border-radius: 20px;
        padding: 10px 17px;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        animation: slideUp 0.8s ease forwards;
        max-width: 700px;
        margin: 0 auto;
      }
  
      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(50px);
        }
  
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
  
      .form-header {
        background: linear-gradient(90deg, var(--primary), var(--primary-light));
        color: white;
        padding: 12px;
        border-radius: 15px;
        text-align: center;
        margin-bottom: 30px;
        font-size: 23px;
        font-weight: 600;
        position: relative;
        overflow: hidden;
      }
  
      .form-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        animation: shine 2s infinite;
      }
  
      @keyframes shine {
        0% {
          left: -100%;
        }
  
        100% {
          left: 100%;
        }
      }
  
      .form-group {
        position: relative;
        margin-bottom: 30px;
      }
  
      .form-control,
      .form-select {
        width: 100%;
        border-bottom: 2px solid var(--gray);
        background: transparent;
        padding: 9px 3px;
        font-size: 1rem;
        color: var(--dark);
        transition: all 0.3s ease;
      }
  
      .form-control:focus,
      .form-select:focus {
        border-bottom-color: var(--primary);
        outline: none;
      }
  
      .form-label {
        position: absolute;
        top: 12px;
        left: 0;
        font-weight: 500;
        color: black;
        pointer-events: none;
        transition: all 0.3s ease;
      }
  
      .form-control:focus~.form-label,
      .form-control:not(:placeholder-shown)~.form-label,
      .form-select:focus~.form-label,
      .form-select:not([value=""])~.form-label {
        top: -20px;
        left: 0;
        font-size: 0.85rem;
        color: var(--primary);
      }
  
      .form-control:focus~.form-label::after,
      .form-control:not(:placeholder-shown)~.form-label::after,
      .form-select:focus~.form-label::after,
      .form-select:not([value=""])~.form-label::after {
        content: '*';
        color: var(--danger);
        margin-left: 5px;
      }
  
      .form-select option {
        background: var(--light);
        color: var(--dark);
      }
  
      .btn-success {
        background: linear-gradient(90deg, var(--success), var(--success-light));
        border: none;
        padding: 15px;
        border-radius: 50px;
        font-weight: 600;
        color: white;
        width: 100%;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
  
      .btn-success:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(108, 92, 231, 0.3);
      }
  
      .btn-success::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        animation: shine 2s infinite;
      }
  
      .error-message {
        color: var(--danger);
        font-size: 0.85rem;
        margin-top: 5px;
        display: none;
      }
  
      .input-error .error-message {
        display: block;
      }
  
      .input-error .form-control,
      .input-error .form-select {
        border-bottom-color: var(--danger);
      }
  
      .form-icon {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray);
        transition: color 0.3s ease;
      }
  
      .form-control:focus~.form-icon,

      /* Override external CSS for form icons and padding */
      .form-control[style*="padding-left: 50px"] {
        padding-left: 50px !important;
      }
      
      .form-control + i[class*="fa"] {
        pointer-events: none !important;
        z-index: 10 !important;
      }
      
      /* Ensure placeholder text doesn't overlap with icons */
      .form-control::placeholder {
        padding-left: 0 !important;
        margin-left: 0 !important;
      }
      
      /* Fix Bootstrap form-control overrides */
      .payment-method-card input.form-control,
      .payment-method-card select.form-control,
      .payment-method-card textarea.form-control {
        padding-left: 50px !important;
      }
      
      .payment-method-card .fas {
        position: absolute !important;
        left: 18px !important;
        z-index: 10 !important;
        pointer-events: none !important;
      }

      /* Disable floating label behavior for offline payment forms */
      #customPaySection .form-control:focus~.form-label,
      #customPaySection .form-control:not(:placeholder-shown)~.form-label,
      #customPaySection .form-select:focus~.form-label,
      #customPaySection .form-select:not([value=""])~.form-label,
      #PayFast_payment_form .form-control:focus~.form-label,
      #PayFast_payment_form .form-control:not(:placeholder-shown)~.form-label,
      #homeCollectionFields .form-control:focus~.form-label,
      #homeCollectionFields .form-control:not(:placeholder-shown)~.form-label,
      #homeCollectionFields .form-select:focus~.form-label,
      #homeCollectionFields .form-select:not([value=""])~.form-label {
        top: auto !important;
        left: auto !important;
        font-size: inherit !important;
        color: inherit !important;
        position: static !important;
        transform: none !important;
        background: none !important;
        z-index: auto !important;
      }

      /* Remove asterisk pseudo-elements from offline payment forms */
      #customPaySection .form-control:focus~.form-label::after,
      #customPaySection .form-control:not(:placeholder-shown)~.form-label::after,
      #customPaySection .form-select:focus~.form-label::after,
      #customPaySection .form-select:not([value=""])~.form-label::after,
      #PayFast_payment_form .form-control:focus~.form-label::after,
      #PayFast_payment_form .form-control:not(:placeholder-shown)~.form-label::after,
      #homeCollectionFields .form-control:focus~.form-label::after,
      #homeCollectionFields .form-control:not(:placeholder-shown)~.form-label::after,
      #homeCollectionFields .form-select:focus~.form-label::after,
      #homeCollectionFields .form-select:not([value=""])~.form-label::after {
        content: none !important;
        display: none !important;
      }

      /* Ensure labels stay in normal position */
      #customPaySection .form-label,
      #PayFast_payment_form .form-label,
      #homeCollectionFields .form-label {
        position: static !important;
        top: auto !important;
        left: auto !important;
        transform: none !important;
        background: none !important;
        z-index: auto !important;
      }

      /* Remove any pseudo-elements that might create background text */
      #customPaySection *::before,
      #customPaySection *::after,
      #PayFast_payment_form *::before,
      #PayFast_payment_form *::after,
      #homeCollectionFields *::before,
      #homeCollectionFields *::after {
        content: none !important;
        display: none !important;
      }

      /* Ensure no background content appears behind form fields */
      #customPaySection .form-control,
      #customPaySection .form-select,
      #PayFast_payment_form .form-control,
      #PayFast_payment_form .form-select,
      #homeCollectionFields .form-control,
      #homeCollectionFields .form-select {
        background: white !important;
        position: relative !important;
        z-index: 5 !important;
      }

      /* Override any vendor CSS that might add background elements */
      #customPaySection,
      #PayFast_payment_form,
      #homeCollectionFields {
        position: relative !important;
      }

      #customPaySection > *,
      #PayFast_payment_form > *,
      #homeCollectionFields > * {
        position: relative !important;
        z-index: 1 !important;
      }

      /* Toast notification animations */
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }

      /* Auto-filled field styling */
      .auto-filled-field {
        border-color: #10B981 !important;
        background-color: #F0FDF4 !important;
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1) !important;
      }
      .form-select:focus~.form-icon {
        color: var(--primary);
      }
  
      .btn-primary {
        background: linear-gradient(90deg, var(--primary), var(--primary-light));
        border: none;
        border-radius: 50px;
        font-weight: 600;
        color: white;
        width: 100%;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
  
      .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(108, 92, 231, 0.3);
      }
  
      .btn-primary::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        animation: shine 2s infinite;
      }
  
      /* form css */
    </style>  
</head>
<body>
    <div class="container-scroller">
        <%- include ('../partials/_navbar.ejs') %>
        <div class="container-fluid page-body-wrapper" style="padding-left: 0%; padding-right: 0%;">
            <%- include ('../partials/SettingsDow.ejs') %>
            <%- include ('../partials/Sidebar.ejs') %>
            <div class="card col-md-10 col-lg-10 mx-auto main-content-card" style="padding-left: 0%;">
                <% if (messages.success) { %>
                    <div style="display: flex; justify-content: end;">
                        <div id="pusher-message-box" style="display: flex; border-left: 8px solid #45439e; color: green; font-weight: bold; font-size: 16px; justify-content: end; align-items: center; height: 70px;" class="mt-3 alert alert-primary">
                            <%= messages.success %>
                        </div>
                    </div>
                <% } %>
                <% if (messages.error) { %>
                    <div style="display: flex; justify-content: end;">
                        <div id="pusher-message-box" style="display: flex; border-left: 8px solid #dc3545; color: red; font-weight: bold; font-size: 16px; justify-content: end; align-items: center; height: 70px;" class="mt-3 alert alert-danger">
                            <%= messages.error %>
                        </div>
                    </div>
                <% } %>
                <script>
                    window.addEventListener('DOMContentLoaded', () => {
                        const msgBox = document.getElementById('pusher-message-box');
                        if (msgBox) {
                            setTimeout(() => {
                                msgBox.style.transition = "opacity 0.5s";
                                msgBox.style.opacity = 0;
                                setTimeout(() => msgBox.style.display = "none", 500);
                            }, 4000);
                        }
                    });
                </script>
                <div class="card-body" style="padding-right: 25px !important; padding-bottom: 0px; padding-left: 0%;">
                  <div class="d-flex justify-content-between" class="crr">
                    <h1 class="card-title ml-3 " style="font-size: 25px;"> Packages</h1>
                    <% if (isAdmin) { %>
                      <div>
                        <a href="/AddPackages" class="btn" style="background-color: #45439e; color:white;
                              border-radius: 11px;
                              ">Add Package</a>
                        <% } %>
                      </div>
                  </div>

                    <!-- Package Cards with Modern Design -->
                    <div class="package-cards">
                        <% packages.forEach(function(package, index){ %>
                            <div class="package-card <%= index === 1 ? 'featured' : '' %>">
                                <% if (index === 1) { %>
                                    <div class="popular-badge">
                                        <i class="bi bi-star-fill"></i>
                                        Most Popular
                                    </div>
                                <% } %>
                                
                                <% if (isAdmin) { %>
                                    <div class="admin-badge">
                                        <div class="user-count-badge">
                                            <i class="bi bi-people-fill"></i>
                                            <%= package.userCount %>
                                        </div>
                                    </div>
                                <% } %>
                                
                                <div class="package-content">
                                    <div class="package-tier">
                                        <h4 class="package-title"><%= package.Package %></h4>
                                        <div class="tier-stars">
                                            <% if (index === 0) { %>
                                                ★★★<span style="opacity: 0.3;">★★</span>
                                            <% } else if (index === 1) { %>
                                                ★★★★<span style="opacity: 0.3;">★</span>
                                            <% } else { %>
                                                ★★★★★
                                            <% } %>
                                        </div>
                                    </div>
                                    
                                    <div class="package-price-section">
                                        <% if (package.discountPercentage > 0) { 
                                            const originalPrice = (package.Price / (1 - package.discountPercentage / 100)).toFixed(0);
                                        %>
                                            <div class="discount-badge">
                                                <i class="bi bi-tags-fill"></i>
                                                <%= package.discountPercentage %>% OFF
                                            </div>
                                            <div class="package-price">
                                                Rs. <%= package.Price %>
                                                <span class="original-price">Rs. <%= originalPrice %></span>
                                                <span class="period">/month</span>
                                            </div>
                                        <% } else { %>
                                            <div class="package-price">Rs. <%= package.Price %><span class="period">/month</span></div>
                                        <% } %>
                                    </div>

                                    <%
                                        const normalize = str => (str || "").trim().toLowerCase();
                                        const isActive = subscription &&
                                                       normalize(subscription.package_name) === normalize(package.Package) &&
                                                       user.invoice === "Paid";

                                        const expiryDate = isActive && subscription.expiry_date ? new Date(subscription.expiry_date) : null;
                                        const now = new Date();
                                        const daysLeft = expiryDate ? Math.max(Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24)), 0) : null;
                                    %>

                                    <% if (isActive) { %>
                                        <div class="status-badge active">
                                            <i class="bi bi-check-circle-fill"></i>
                                            <div class="status-info">
                                                <strong>Active Plan</strong>
                                                <% if (expiryDate) { %>
                                                    <div class="expiry-info">
                                                        Expires: <%= expiryDate.toLocaleDateString("en-GB") %>
                                                        (<%= daysLeft %> day<%= daysLeft === 1 ? '' : 's' %> left)
                                                    </div>
                                                <% } %>
                                            </div>
                                        </div>
                                    <% } else { %>
                                        <div class="status-badge inactive">
                                            <i class="bi bi-exclamation-circle-fill"></i>
                                            <span>No active plan for this package</span>
                                        </div>
                                    <% } %>
                                    
                                    <ul class="package-features">
                                        <li>
                                            <i class="bi bi-wifi"></i>
                                            <span>Up to <%= package.Speed %> Mbps Speed</span>
                                        </li>
                                        <li>
                                            <i class="bi bi-graph-up-arrow"></i>
                                            <span><%= package.Data_Used %> GB Monthly Usage</span>
                                        </li>
                                        <li>
                                            <i class="bi bi-clock-history"></i>
                                            <span>Valid until <%= package.Offer_Valid %></span>
                                        </li>
                                        <li>
                                            <i class="bi bi-shield-check"></i>
                                            <span><%= package.limits %> Limits</span>
                                        </li>
                                        <li>
                                            <i class="bi bi-headset"></i>
                                            <span>24/7 Customer Support</span>
                                        </li>
                                        <li>
                                            <i class="bi bi-tools"></i>
                                            <span>Free Installation</span>
                                        </li>
                                    </ul>
                                    
                                    <div class="package-footer">
                                        <p class="tax-info">
                                            <i class="bi bi-info-circle"></i>
                                            Prices inclusive of all taxes
                                        </p>
                                        
                                        <div class="package-actions">
                                            <% if (isAdmin) { %>
                                                <div class="admin-actions">
                                                    <!-- Delete Button -->
                                                    <form action="/package/<%= package.id %>?_method=DELETE" method="POST"
                                                        style="display:inline;"
                                                        onsubmit="return confirm('Are you sure you want to delete this package?');">
                                                        <button type="submit" class="admin-btn delete-btn" title="Delete Package">
                                                            <i class="bi bi-trash"></i>
                                                        </button>
                                                    </form>
                                                    
                                                    <!-- Edit Button -->
                                                    <button class="admin-btn edit-btn" title="Edit Package"
                                                        data-bs-toggle="modal" data-bs-target="#updateModal<%= package.id %>">
                                                        <i class="bi bi-pencil"></i>
                                                    </button>
                                                    
                                                    <!-- Discount Button -->
                                                    <button class="admin-btn discount-btn" title="Set Discount"
                                                        data-toggle="modal" data-target="#discountModal<%= package.id %>">
                                                        <i class="bi bi-tag"></i>
                                                    </button>
                                                </div>
                                            <% } else { %>
                                                <button class="package-btn" 
                                                    data-package="<%= package.Package %>"
                                                    data-price="<%= package.Price %>">
                                                    <i class="bi bi-cart-plus"></i>
                                                    Subscribe Now
                                                </button>
                                            <% } %>
                                        </div>
                                    </div>
                                </div>

                                <!-- Discount Modal -->
                                <div class="modal fade" id="discountModal<%= package.id %>" tabindex="-1"
                                    role="dialog" aria-labelledby="discountModalLabel<%= package.id %>"
                                    aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="discountModalLabel<%= package.id %>">
                                                    Set Discount for <%= package.Package %>
                                                </h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <form action="/discount/<%= package.id %>" method="POST">
                                                    <input type="hidden" name="id" value="<%= package.id %>">
                                                    
                                                    <div class="form-group">
                                                        <label for="discountPrice<%= package.id %>">New Price</label>
                                                        <input type="text" class="form-control" id="discountPrice<%= package.id %>"
                                                            value="<%= package.Price %>" name="Price" required>
                                                    </div>
                                                    
                                                    <div class="form-group">
                                                        <label for="discountPercentage<%= package.id %>">Discount Percentage</label>
                                                        <input type="number" class="form-control" id="discountPercentage<%= package.id %>"
                                                            name="discountPercentage" step="0.01" min="0" max="100"
                                                            placeholder="Enter discount percentage">
                                                    </div>
                                                    
                                                    <button type="submit" class="btn btn-primary">Apply Discount</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    </div>
                </div>
            </div>
        </div>
    </div>
   <div class="modal fade" id="paymentModal" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content" style="
      background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
      border-radius: 20px;
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.1);
      padding: 0;
      border: none;
      overflow: hidden;
      position: relative;
    ">
      
      <!-- Professional Header Gradient -->
      <div style="
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 2rem;
        text-align: center;
        position: relative;
        overflow: hidden;
      ">
        <!-- Floating Close Button -->
        <button type="button" data-bs-dismiss="modal" aria-label="Close" style="
          position: absolute;
          top: 15px;
          right: 15px;
          width: 40px;
          height: 40px;
          background: rgba(255, 255, 255, 0.15);
          color: white;
          border: 2px solid rgba(255, 255, 255, 0.3);
          border-radius: 50%;
          font-size: 1.2rem;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          transition: all 0.3s ease;
          backdrop-filter: blur(10px);
          z-index: 10;
        " onmouseover="this.style.background='rgba(255, 255, 255, 0.25)'; this.style.transform='scale(1.1)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.15)'; this.style.transform='scale(1)'">
          &times;
        </button>
        
        <!-- Header Icon -->
        <div style="
          width: 80px;
          height: 80px;
          background: rgba(255, 255, 255, 0.2);
          border-radius: 20px;
          display: flex;
          align-items: center;
          justify-content: center;
          margin: 0 auto 1rem;
          backdrop-filter: blur(10px);
          border: 1px solid rgba(255, 255, 255, 0.3);
        ">
          <i class="fas fa-credit-card" style="font-size: 2rem; color: white;"></i>
        </div>
        
        <h2 class="mb-2" style="
          color: white;
          font-size: 2rem;
          font-weight: 700;
          text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
          margin: 0;
        ">Premium Subscription</h2>
        <p style="
          color: rgba(255, 255, 255, 0.9);
          font-size: 1.1rem;
          margin: 0.5rem 0 0;
          font-weight: 400;
        ">Choose your preferred payment method</p>
      </div>
      
      <!-- Modal Body -->
      <div style="padding: 2rem;">
        <!-- Payment Method Selection -->
        <div id="paymentChoice" class="text-center mb-4">
          <div class="row g-3">
            <!-- Online Payment Card -->
            <div class="col-md-6">
              <div id="manualPayBtn" class="payment-method-card" style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border: 2px solid transparent;
                border-radius: 16px;
                padding: 2rem 1.5rem;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
                text-align: center;
                color: white;
                box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
              " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 20px 40px rgba(102, 126, 234, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 25px rgba(102, 126, 234, 0.3)'">
                <div style="
                  width: 60px;
                  height: 60px;
                  background: rgba(255, 255, 255, 0.2);
                  border-radius: 50%;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  margin: 0 auto 1rem;
                ">
                  <i class="fas fa-globe" style="font-size: 1.5rem;"></i>
                </div>
                <h4 style="margin-bottom: 0.5rem; font-weight: 600;">Online Payment</h4>
                <p style="margin: 0; opacity: 0.9; font-size: 0.9rem;">Secure payment gateway</p>
                <div style="
                  position: absolute;
                  bottom: 0;
                  left: 0;
                  right: 0;
                  height: 3px;
                  background: rgba(255, 255, 255, 0.3);
                "></div>
              </div>
            </div>
            
            <!-- Offline Payment Card -->
            <div class="col-md-6">
              <div id="customPayBtn" class="payment-method-card" style="
                background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
                border: 2px solid transparent;
                border-radius: 16px;
                padding: 2rem 1.5rem;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
                text-align: center;
                color: white;
                box-shadow: 0 10px 25px rgba(17, 153, 142, 0.3);
              " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 20px 40px rgba(17, 153, 142, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 25px rgba(17, 153, 142, 0.3)'">
                <div style="
                  width: 60px;
                  height: 60px;
                  background: rgba(255, 255, 255, 0.2);
                  border-radius: 50%;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  margin: 0 auto 1rem;
                ">
                  <i class="fas fa-mobile-alt" style="font-size: 1.5rem;"></i>
                </div>
                <h4 style="margin-bottom: 0.5rem; font-weight: 600;">Offline Pay</h4>
                <p style="margin: 0; opacity: 0.9; font-size: 0.9rem;">JazzCash, Easypaisa & Home Collection</p>
                <div style="
                  position: absolute;
                  bottom: 0;
                  left: 0;
                  right: 0;
                  height: 3px;
                  background: rgba(255, 255, 255, 0.3);
                "></div>
              </div>
            </div>
          </div>
        </div>

     <!-- OFFLINE PAYMENT SECTION -->
<div id="customPaySection" style="display: none;">
  <div style="
    background: linear-gradient(135deg, rgba(17, 153, 142, 0.1) 0%, rgba(56, 239, 125, 0.1) 100%);
    border-radius: 16px;
    padding: 2rem;
    margin-top: 1rem;
    border: 1px solid rgba(17, 153, 142, 0.2);
  ">
    <div class="text-center mb-4">
      <div style="
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        box-shadow: 0 10px 25px rgba(17, 153, 142, 0.3);
      ">
        <i class="fas fa-mobile-alt" style="font-size: 2rem; color: white;"></i>
      </div>
      <h4 style="color: #4a5568; margin-bottom: 0.5rem; font-weight: 600;">Offline Payment</h4>
      <p style="color: #718096; margin: 0; font-size: 0.95rem;">Pay using JazzCash, Easypaisa or request Home Collection</p>
    </div>
    
    <!-- Selected Package Info -->
    <div style="
      background: rgba(255, 255, 255, 0.7);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      text-align: center;
      border: 1px solid rgba(17, 153, 142, 0.2);
    ">
      <h5 style="color: #2d3748; margin-bottom: 0.5rem;">Selected Package</h5>
      <h3 id="selectedPackage" style="color: #11998e; font-weight: 700; margin: 0;"></h3>
    </div>

    <!-- Payment Method Cards -->
    <div class="row g-3 mb-4">
      <!-- JazzCash Card -->
      <div class="col-md-4 col-12 mb-3">
        <div class="payment-option-card" data-bs-toggle="collapse" data-bs-target="#jazzCashInfo" style="
          background: white;
          border: 2px solid #e2e8f0;
          border-radius: 16px;
          padding: 1.5rem;
          text-align: center;
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        " onmouseover="this.style.transform='translateY(-5px)'; this.style.borderColor='#11998e'; this.style.boxShadow='0 10px 25px rgba(17, 153, 142, 0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='#e2e8f0'; this.style.boxShadow='0 4px 15px rgba(0, 0, 0, 0.08)'">
          <img src="/images/Jazz cash logo.svg" height="45" style="margin-bottom: 1rem;">
          <h6 style="color: #4a5568; margin: 0; font-weight: 600;">JazzCash</h6>
          <p style="color: #718096; font-size: 0.85rem; margin: 0.25rem 0 0;">Tap to view details</p>
        </div>
        <div class="collapse mt-3" id="jazzCashInfo">
          <div style="
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            color: white;
          ">
            <img src="/images/JAZZCASH QR.png" class="img-fluid rounded mb-3" style="max-height: 150px; background: white; padding: 10px;">
            <p style="margin: 0; opacity: 0.9; font-size: 0.9rem;">Send money to:</p>
            <h5 style="margin: 0.5rem 0 0; font-weight: 700;">+92 306 9753003</h5>
          </div>
        </div>
      </div>

      <!-- Easypaisa Card -->
      <div class="col-md-4 col-12 mb-3">
        <div class="payment-option-card" data-bs-toggle="collapse" data-bs-target="#easypaisaInfo" style="
          background: white;
          border: 2px solid #e2e8f0;
          border-radius: 16px;
          padding: 1.5rem;
          text-align: center;
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        " onmouseover="this.style.transform='translateY(-5px)'; this.style.borderColor='#11998e'; this.style.boxShadow='0 10px 25px rgba(17, 153, 142, 0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='#e2e8f0'; this.style.boxShadow='0 4px 15px rgba(0, 0, 0, 0.08)'">
          <img src="/images/EASYPAISA logo.svg" height="45" style="margin-bottom: 1rem;">
          <h6 style="color: #4a5568; margin: 0; font-weight: 600;">Easypaisa</h6>
          <p style="color: #718096; font-size: 0.85rem; margin: 0.25rem 0 0;">Tap to view details</p>
        </div>
        <div class="collapse mt-3" id="easypaisaInfo">
          <div style="
            background: linear-gradient(135deg, #00b04f 0%, #7ed321 100%);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            color: white;
          ">
            <img src="/images/easypaisa.jpeg" class="img-fluid rounded mb-3" style="max-height: 150px; background: white; padding: 10px;">
            <p style="margin: 0; opacity: 0.9; font-size: 0.9rem;">Send money to:</p>
            <h5 style="margin: 0.5rem 0 0; font-weight: 700;">+92 306 9753003</h5>
          </div>
        </div>
      </div>

      <!-- Home Collection Card -->
      <div class="col-md-4 col-12 mb-3">
        <div class="payment-option-card" data-bs-toggle="collapse" data-bs-target="#homeCollectionInfo" style="
          background: white;
          border: 2px solid #e2e8f0;
          border-radius: 16px;
          padding: 1.5rem;
          text-align: center;
          cursor: pointer;
          transition: all 0.3s ease;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        " onmouseover="this.style.transform='translateY(-5px)'; this.style.borderColor='#11998e'; this.style.boxShadow='0 10px 25px rgba(17, 153, 142, 0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='#e2e8f0'; this.style.boxShadow='0 4px 15px rgba(0, 0, 0, 0.08)'">
          <div style="
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #8B5CF6 0%, #A855F7 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
          ">
            <i class="fas fa-home" style="color: white; font-size: 1.2rem;"></i>
          </div>
          <h6 style="color: #4a5568; margin: 0; font-weight: 600;">Home Collection</h6>
          <p style="color: #718096; font-size: 0.85rem; margin: 0.25rem 0 0;">Payment at your doorstep</p>
          <small style="color: #8B5CF6; font-weight: 500; margin-top: 0.5rem; display: block;">👆 Click to select</small>
        </div>
        <div class="collapse mt-3" id="homeCollectionInfo">
          <div style="
            background: linear-gradient(135deg, #8B5CF6 0%, #A855F7 100%);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            color: white;
          ">
            <div style="
              background: rgba(255, 255, 255, 0.2);
              border-radius: 50px;
              padding: 1rem;
              margin: 0 auto 1rem;
              width: fit-content;
            ">
              <i class="fas fa-home" style="font-size: 2rem;"></i>
            </div>
            <p style="margin: 0; opacity: 0.9; font-size: 0.9rem;">We collect payment from your home</p>
            <h6 style="margin: 0.5rem 0 0; font-weight: 700;">📝 Fill your details below</h6>
            <p style="margin: 0.5rem 0 0; opacity: 0.8; font-size: 0.8rem;">Address & contact fields will appear automatically</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Payment Form -->
    <% if (user) { %>
    <form id="paymentForm" action="/subscription" method="POST" class="mt-4">
      <input type="hidden" name="active" value="Pending">
      <input type="hidden" name="package_name" id="package_name">
      <input type="hidden" name="user_id" value="<%= user.id %>">

      <div class="row g-3">
        <!-- Username -->
        <div class="col-md-6">
          <label class="form-label" style="font-weight: 600; color: #4a5568; margin-bottom: 0.5rem;">Username</label>
          <div style="position: relative;">
            <input type="text" class="form-control" id="username" name="username" value="<%= user.Username %>" readonly placeholder="Auto-filled" style="
              border: 2px solid #e2e8f0;
              color: black;
              border-radius: 12px;
              padding: 12px 16px 12px 50px !important;
              font-size: 1rem;
              
              transition: all 0.3s ease;
              padding-left: 50px !important;
            ">
            <i class="fas fa-user" style="
              position: absolute;
              left: 18px;
              top: 50%;
              transform: translateY(-50%);
              color: #11998e;
              font-size: 1rem;
              z-index: 10;
              pointer-events: none;
            "></i>
          </div>
        </div>

        <!-- Transaction ID -->
        <div class="col-md-6">
          <label class="form-label" style="font-weight: 600; color: #4a5568; margin-bottom: 0.5rem;">Transaction ID *</label>
          <div style="position: relative;">
            <input type="text" class="form-control" id="transaction_id" name="transaction_id" required placeholder="Enter transaction ID (e.g. TXN12345678)" style="
              border: 2px solid #e2e8f0;
              color: black;
              border-radius: 12px;
              padding: 12px 16px 12px 50px !important;
              font-size: 1rem;
              transition: all 0.3s ease;
              padding-left: 50px !important;
            " onfocus="this.style.borderColor='#11998e'; this.style.boxShadow='0 0 0 3px rgba(17, 153, 142, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
            <i class="fas fa-receipt" style="
              position: absolute;
              left: 18px;
              top: 50%;
              transform: translateY(-50%);
              color: #11998e;
              font-size: 1rem;
              z-index: 10;
              pointer-events: none;
            "></i>
          </div>
        </div>

        <!-- Amount -->
        <div class="col-md-6">
          <label class="form-label" style="font-weight: 600; color: #4a5568; margin-bottom: 0.5rem;">Package Amount</label>
          <div style="position: relative;">
            <input type="number" class="form-control" id="amount" name="amount" required readonly placeholder="Package amount will be auto-filled" style="
              border: 2px solid #e2e8f0;
              border-radius: 12px;
              color: black;
              padding: 12px 16px 12px 50px !important;
              font-size: 1rem;
              
              transition: all 0.3s ease;
              padding-left: 50px !important;
            ">
            <i class="fas fa-money-bill-wave" style="
              position: absolute;
              left: 18px;
              top: 50%;
              transform: translateY(-50%);
              color: #11998e;
              font-size: 1rem;
              z-index: 10;
              pointer-events: none;
            "></i>
          </div>
        </div>

        <!-- Custom Amount -->
        <div class="col-md-6">
          <label class="form-label" style="font-weight: 600; color: #4a5568; margin-bottom: 0.5rem;">Custom Amount (Optional)</label>
          <div style="position: relative;">
            <input type="number" class="form-control" id="custom_amount" name="custom_amount" placeholder="Enter custom amount if applicable" style="
              border: 2px solid #e2e8f0;
              border-radius: 12px;
              padding: 12px 16px 12px 50px !important;
              font-size: 1rem;
              transition: all 0.3s ease;
              padding-left: 50px !important;
            " onfocus="this.style.borderColor='#11998e'; this.style.boxShadow='0 0 0 3px rgba(17, 153, 142, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
            <i class="fas fa-edit" style="
              position: absolute;
              left: 18px;
              top: 50%;
              transform: translateY(-50%);
              color: #11998e;
              font-size: 1rem;
              z-index: 10;
              pointer-events: none;
            "></i>
          </div>
        </div>

        <!-- Home Collection Fields (Optional) -->
        <div class="col-12" id="homeCollectionFields" style="display: none;">
          <div style="
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(168, 85, 247, 0.1) 100%);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
          ">
            <h6 style="color: #7C3AED; margin-bottom: 1rem; font-weight: 600;">
              <i class="fas fa-home" style="margin-right: 8px;"></i>
              Home Collection Details (Optional)
            </h6>

            <!-- Profile Data Info -->
            <% if (user && (user.Address || user.Number)) { %>
            <div style="
              background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
              border: 1px solid rgba(16, 185, 129, 0.2);
              border-radius: 8px;
              padding: 12px 16px;
              margin-bottom: 1rem;
              display: flex;
              align-items: center;
              gap: 10px;
            ">
              <i class="fas fa-info-circle" style="color: #10B981; font-size: 1rem;"></i>
              <div style="color: #065F46; font-size: 0.9rem;">
                <strong>Auto-fill available:</strong> 
                <% if (user.Address) { %>Address<% } %>
                <% if (user.Address && user.Number) { %> and <% } %>
                <% if (user.Number) { %>Phone Number<% } %>
                will be filled from your profile.
              </div>
            </div>
            <% } else { %>
            <div style="
              background: linear-gradient(135deg, rgba(251, 191, 36, 0.1) 0%, rgba(245, 158, 11, 0.1) 100%);
              border: 1px solid rgba(251, 191, 36, 0.2);
              border-radius: 8px;
              padding: 12px 16px;
              margin-bottom: 1rem;
              display: flex;
              align-items: center;
              gap: 10px;
            ">
              <i class="fas fa-exclamation-triangle" style="color: #D97706; font-size: 1rem;"></i>
              <div style="color: #92400E; font-size: 0.9rem;">
                <strong>Profile incomplete:</strong> Please fill in your address and phone number below. Consider updating your profile for faster future orders.
              </div>
            </div>
            <% } %>
            
            <div class="row g-3">
              <!-- Request Home Collection Checkbox -->
              <div class="col-12">
                <div class="form-check" style="margin-bottom: 1rem;">
                  <input class="form-check-input" type="checkbox" id="requestHomeCollection" name="home_collection" value="yes" style="
                    width: 20px;
                    height: 20px;
                    accent-color: #8B5CF6;
                  " onchange="toggleAddressFields()">
                  <label class="form-check-label" for="requestHomeCollection" style="
                    font-weight: 600;
                    color: #4a5568;
                    margin-left: 8px;
                    font-size: 1rem;
                  ">
                    Request Home Collection Service
                  </label>
                </div>
              </div>

              <!-- Address Fields (Hidden initially) -->
              <div class="col-md-6 col-12 mb-3" id="addressField" style="display: none;">
                <label class="form-label" style="font-weight: 600; color: #4a5568; margin-bottom: 0.5rem;">Collection Address *</label>
                <div style="position: relative;">
                  <textarea class="form-control" id="collection_address" name="collection_address" rows="3" placeholder="Enter your complete address for collection" style="
                    border: 2px solid #e2e8f0;
                    border-radius: 12px;
                    color: black;
                    padding: 12px 16px 12px 50px !important;
                    font-size: 1rem;
                    transition: all 0.3s ease;
                    resize: vertical;
                    padding-left: 50px !important;
                  " onfocus="this.style.borderColor='#8B5CF6'; this.style.boxShadow='0 0 0 3px rgba(139, 92, 246, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'"></textarea>
                  <i class="fas fa-map-marker-alt" style="
                    position: absolute;
                    left: 18px;
                    top: 20px;
                    color: #8B5CF6;
                    font-size: 1rem;
                    z-index: 10;
                    pointer-events: none;
                  "></i>
                </div>
              </div>

              <!-- Phone Number -->
              <div class="col-md-6 col-12 mb-3" id="phoneField" style="display: none;">
                <label class="form-label" style="font-weight: 600; color: #4a5568; margin-bottom: 0.5rem;">Contact Number *</label>
                <div style="position: relative;">
                  <input type="tel" class="form-control" id="contact_number" name="contact_number" placeholder="e.g. +92 300 1234567" style="
                    border: 2px solid #e2e8f0;
                    color: black;
                    border-radius: 12px;
                    padding: 12px 16px 12px 50px !important;
                    font-size: 1rem;
                    transition: all 0.3s ease;
                    padding-left: 50px !important;
                  "  this.style.boxShadow='0 0 0 3px rgba(139, 92, 246, 0.1)'"  this.style.boxShadow='none'">
                  <i class="fas fa-phone" style="
                    position: absolute;
                    left: 18px;
                    top: 50%;
                    transform: translateY(-50%);
                    color: #8B5CF6;
                    font-size: 1rem;
                    z-index: 10;
                    pointer-events: none;
                  "></i>
                </div>
              </div>

              <!-- Preferred Time -->
              <div class="col-md-6 col-12 mb-3" id="timeField" style="display: none;">
                <label class="form-label" style="font-weight: 600; color: #4a5568; margin-bottom: 0.5rem;">Preferred Collection Time</label>
                <div style="position: relative;">
                  <select class="form-control" id="preferred_time" name="preferred_time" style="
                    border: 2px solid #e2e8f0;
                    border-radius: 12px;
                    padding: 12px 16px 12px 50px !important;
                    font-size: 1rem;
                    transition: all 0.3s ease;
                    background-color: white;
                    padding-left: 50px !important;
                  " onfocus="this.style.borderColor='#8B5CF6'; this.style.boxShadow='0 0 0 3px rgba(139, 92, 246, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'">
                    <option value="">Select preferred time</option>
                    <option value="morning">Morning (9 AM - 12 PM)</option>
                    <option value="afternoon">Afternoon (12 PM - 5 PM)</option>
                    <option value="evening">Evening (5 PM - 8 PM)</option>
                  </select>
                  <i class="fas fa-clock" style="
                    position: absolute;
                    left: 18px;
                    top: 50%;
                    transform: translateY(-50%);
                    color: #8B5CF6;
                    font-size: 1rem;
                    z-index: 10;
                    pointer-events: none;
                  "></i>
                </div>
              </div>

              <!-- Special Instructions -->
              <div class="col-md-6 col-12 mb-3" id="instructionsField" style="display: none;">
                <label class="form-label" style="font-weight: 600; color: #4a5568; margin-bottom: 0.5rem;">Special Instructions</label>
                <div style="position: relative;">
                  <textarea class="form-control" id="special_instructions" name="special_instructions" rows="3" placeholder="Any special instructions for collection (e.g. gate no, landmark)" style="
                    border: 2px solid #e2e8f0;
                    border-radius: 12px;
                    padding: 12px 16px 12px 50px !important;
                    font-size: 1rem;
                    transition: all 0.3s ease;
                    resize: vertical;
                    padding-left: 50px !important;
                  " onfocus="this.style.borderColor='#8B5CF6'; this.style.boxShadow='0 0 0 3px rgba(139, 92, 246, 0.1)'" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none'"></textarea>
                  <i class="fas fa-sticky-note" style="
                    position: absolute;
                    left: 18px;
                    top: 20px;
                    color: #8B5CF6;
                    font-size: 1rem;
                    z-index: 10;
                    pointer-events: none;
                  "></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Important Notice -->
      <div style="
        background: linear-gradient(135deg, rgba(245, 166, 35, 0.1) 0%, rgba(251, 211, 141, 0.1) 100%);
        border: 1px solid rgba(245, 166, 35, 0.3);
        border-radius: 12px;
        padding: 1rem;
        margin: 1.5rem 0;
      ">
        <div class="d-flex align-items-start gap-3">
          <i class="fas fa-info-circle" style="color: #f59e0b; font-size: 1.2rem; margin-top: 2px;"></i>
          <div>
            <h6 style="color: #92400e; margin-bottom: 0.5rem; font-weight: 600;">Payment Instructions</h6>
            <ol style="color: #92400e; font-size: 0.9rem; margin: 0; padding-left: 1rem;">
              <li>Complete payment using any method above</li>
              <li>Copy the transaction ID from your payment confirmation</li>
              <li>Enter the transaction ID in the form above</li>
              <li>Submit for verification and activation</li>
            </ol>
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <button type="submit" style="
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        border: none;
        color: white;
        width: 100%;
        padding: 16px;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 10px 25px rgba(17, 153, 142, 0.3);
        position: relative;
        overflow: hidden;
      " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 15px 35px rgba(17, 153, 142, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 25px rgba(17, 153, 142, 0.3)'">
        <i class="fas fa-paper-plane me-2"></i>Submit Payment Details
      </button>
      
      <!-- Hidden input for home collection - will be set by JavaScript -->
      <input type="hidden" id="home_collection_hidden" name="home_collection_final" value="no">
    </form>
    <% } %>
  </div>
</div>

      </div>

      <!-- ONLINE PAYMENT SECTION -->
      <div id="manualPaySection" style="display: none;">
        <div style="
          background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
          border-radius: 16px;
          padding: 2rem;
          margin-top: 1rem;
          border: 1px solid rgba(102, 126, 234, 0.2);
        ">
          <div class="text-center mb-4">
            <div style="
              width: 80px;
              height: 80px;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              border-radius: 20px;
              display: flex;
              align-items: center;
              justify-content: center;
              margin: 0 auto 1rem;
              box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            ">
              <i class="fas fa-shield-alt" style="font-size: 2rem; color: white;"></i>
            </div>
            <h4 style="color: #4a5568; margin-bottom: 0.5rem; font-weight: 600;">Secure Online Payment</h4>
            <p style="color: #718096; margin: 0; font-size: 0.95rem;">Complete your payment safely through our encrypted gateway</p>
          </div>
          
          <form id="PayFast_payment_form" method="post" action="https://ipg1.apps.net.pk/Ecommerce/api/Transaction/PostTransaction">
            <input type="hidden" name="CURRENCY_CODE" id="currency_code" />
            <input type="hidden" name="MERCHANT_ID" id="merchant_id" />
            <input type="hidden" name="TOKEN" id="token" />
            <input type="hidden" name="BASKET_ID" id="basket_id" />
            <input type="hidden" name="SUCCESS_URL" value="https://app.clickopticx.com/success" />
            <input type="hidden" name="FAILURE_URL" value="https://app.clickopticx.com/failure" />
            <input type="hidden" name="NOTIFICATION_URL" value="https://app.clickopticx.com/payfast-itn" />
            <input type="hidden" name="SIGNATURE" id="signature" />
  
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label" style="font-weight: 600; color: #4a5568; margin-bottom: 0.5rem;">Package Amount</label>
                <div style="position: relative;">
                  <input type="text" name="TXNAMT" class="form-control" id="txnAmtInput" readonly placeholder="Auto-filled from package" style="
                    border: 2px solid #e2e8f0;
                    border-radius: 12px;
                    padding: 12px 16px 12px 50px !important;
                    font-size: 1rem;
                    color: black;
                    transition: all 0.3s ease;
                    padding-left: 50px !important;
                  ">
                  <i class="fas fa-dollar-sign" style="
                    position: absolute;
                    left: 18px;
                    top: 50%;
                    transform: translateY(-50%);
                    color: #667eea;
                    font-size: 1rem;
                    z-index: 10;
                    pointer-events: none;
                  "></i>
                </div>
              </div>
              
              <div class="col-md-6">
                <label class="form-label" style="font-weight: 600; color: #4a5568; margin-bottom: 0.5rem;">Active Date</label>
                <div style="position: relative;">
                  <input type="text" name="ORDER_DATE" class="form-control" id="order_date" readonly placeholder="Auto-filled today" style="
                    border: 2px solid #e2e8f0;
                    border-radius: 12px;
                    padding: 12px 16px 12px 50px !important;
                    font-size: 1rem;
                    color: black;
                    transition: all 0.3s ease;
                    padding-left: 50px !important;
                  ">
                  <i class="fas fa-calendar-alt" style="
                    position: absolute;
                    left: 18px;
                    top: 50%;
                    transform: translateY(-50%);
                    color: #667eea;
                    font-size: 1rem;
                    z-index: 10;
                    pointer-events: none;
                  "></i>
                </div>
              </div>
            </div>
  
            <button type="submit" id="submitBtn" style="
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              border: none;
              color: white;
              width: 100%;
              padding: 15px;
              border-radius: 12px;
              font-size: 1.1rem;
              font-weight: 600;
              margin-top: 2rem;
              transition: all 0.3s ease;
              box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
              position: relative;
              overflow: hidden;
            " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 15px 35px rgba(102, 126, 234, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 25px rgba(102, 126, 234, 0.3)'">
              <i class="fas fa-lock me-2"></i>Proceed to Secure Payment
            </button>
            
            <!-- Security Badges -->
            <div class="text-center mt-3">
              <small class="text-muted d-flex align-items-center justify-content-center gap-2">
                <i class="fas fa-shield-alt text-success"></i>
                <span>256-bit SSL Encrypted</span>
                <span class="mx-1">•</span>
                <i class="fas fa-check-circle text-success"></i>
                <span>PCI DSS Compliant</span>
              </small>
            </div>
          </form>
        </div>
      </div>

    </div>
  </div>
</div>

    <%- include ('../partials/_footer.ejs') %>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const subscribeButtons = document.querySelectorAll('.package-btn');

            subscribeButtons.forEach(button => {
                button.addEventListener('click', async function () {
                    const packageId = this.dataset.packageId;
                    const packageName = this.dataset.package;
                    const packagePrice = parseFloat(this.dataset.price).toFixed(2);

                    console.log(`Selected Package: ${packageName}, Price: ${packagePrice}, ID: ${packageId}`);

                    // Update modal fields
                    document.getElementById('selectedPackage').textContent = packageName;
                    document.getElementById('package_name').value = packageName;
                    document.getElementById('amount').value = packagePrice;

                    // Fetch PayFast token
                    try {
                        const response = await fetch('/get-payfast-token', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ packagePrice }),
                        });

                        const data = await response.json();
                        console.log('PayFast Token Response:', data);

                        if (!data.success) {
                            alert('Failed to retrieve PayFast token: ' + data.message);
                            return;
                        }

                        // Update PayFast form
                        document.getElementById('currency_code').value = data.currency_code;
                        document.getElementById('merchant_id').value = data.merchant_id;
                        document.getElementById('token').value = data.token;
                        document.getElementById('basket_id').value = data.basket_id;
                        document.getElementById('txnAmtInput').value = data.trans_amount;
                        document.getElementById('order_date').value = data.order_date;
                        document.getElementById('signature').value = data.signature;

                        // Store BASKET_ID in session or pass to success route
                        sessionStorage.setItem('basket_id', data.basket_id);

                        // Show payment modal
                        document.getElementById('paymentChoice').style.display = 'block';
                        document.getElementById('manualPaySection').style.display = 'none';
                        document.getElementById('customPaySection').style.display = 'none';

                        const modal = new bootstrap.Modal(document.getElementById('paymentModal'));
                        modal.show();
                    } catch (error) {
                        console.error('Error fetching PayFast token:', error);
                        alert('An error occurred while processing your request.');
                    }
                });
            });

            document.getElementById('manualPayBtn').addEventListener('click', () => {
                console.log('PayFast selected');
                document.getElementById('paymentChoice').style.display = 'none';
                document.getElementById('manualPaySection').style.display = 'block';
                document.getElementById('customPaySection').style.display = 'none';
            });

            document.getElementById('customPayBtn').addEventListener('click', () => {
                console.log('Custom Pay selected');
                document.getElementById('paymentChoice').style.display = 'none';
                document.getElementById('manualPaySection').style.display = 'none';
                document.getElementById('customPaySection').style.display = 'block';
            });

            document.getElementById('PayFast_payment_form').addEventListener('submit', (e) => {
                console.log('Submitting PayFast form with data:', {
                    currency_code: document.getElementById('currency_code').value,
                    merchant_id: document.getElementById('merchant_id').value,
                    token: document.getElementById('token').value,
                    basket_id: document.getElementById('basket_id').value,
                    txnAmt: document.getElementById('txnAmtInput').value,
                    order_date: document.getElementById('order_date').value,
                    signature: document.getElementById('signature').value,
                });
            });
        });

        // Beautiful Boost WiFi Functionality
        const actionBtn = document.querySelector('[data-action="notif"]');
        if (actionBtn) {
            actionBtn.addEventListener('click', (e) => {
                e.preventDefault();
                showBoostModal();
            });
        }

        function showBoostModal() {
            // Create boost modal
            const boostModal = document.createElement('div');
            boostModal.className = 'boost-modal';
            
            // Generate random boost stats
            const speedBoost = Math.floor(Math.random() * 25) + 15; // 15-40%
            const latencyReduction = Math.floor(Math.random() * 20) + 10; // 10-30ms
            const stabilityImprovement = Math.floor(Math.random() * 15) + 85; // 85-100%
            
            boostModal.innerHTML = `
                <div class="boost-content">
                    <div class="boost-icon">
                        <i class="bi bi-rocket-takeoff"></i>
                    </div>
                    
                    <h3 class="boost-title">WiFi Boost Activated!</h3>
                    <p class="boost-subtitle">Optimizing your connection for maximum performance</p>
                    
                    <div class="boost-progress-container">
                        <div class="boost-progress-bar"></div>
                    </div>
                    
                    <div class="boost-stats">
                        <div class="boost-stat">
                            <div class="boost-stat-value">+${speedBoost}%</div>
                            <div class="boost-stat-label">Speed Boost</div>
                        </div>
                        <div class="boost-stat">
                            <div class="boost-stat-value">-${latencyReduction}ms</div>
                            <div class="boost-stat-label">Latency Reduced</div>
                        </div>
                    </div>
                    
                    <div class="boost-stats">
                        <div class="boost-stat">
                            <div class="boost-stat-value">${stabilityImprovement}%</div>
                            <div class="boost-stat-label">Connection Stability</div>
                        </div>
                        <div class="boost-stat">
                            <div class="boost-stat-value">2.5x</div>
                            <div class="boost-stat-label">Signal Strength</div>
                        </div>
                    </div>
                    
                    <button class="boost-close-btn" onclick="closeBoostModal()">
                        <i class="bi bi-check-circle me-2"></i>
                        Awesome!
                    </button>
                </div>
            `;
            
            document.body.appendChild(boostModal);
            
            // Show initial toast
            showBoostToast();
            
            // Auto close after 6 seconds
            setTimeout(() => {
                if (document.body.contains(boostModal)) {
                    closeBoostModal();
                }
            }, 6000);
        }

        function showBoostToast() {
            const toast = document.createElement('div');
            toast.className = 'boost-toast';
            toast.innerHTML = `
                <i class="bi bi-rocket-takeoff me-2"></i>
                WiFi boost activated! Performance optimizing...
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    toast.style.animation = 'fadeOut 0.3s ease-out forwards';
                    setTimeout(() => {
                        if (document.body.contains(toast)) {
                            document.body.removeChild(toast);
                        }
                    }, 300);
                }
            }, 3000);
        }

        function closeBoostModal() {
            const modal = document.querySelector('.boost-modal');
            if (modal) {
                modal.style.animation = 'fadeOut 0.3s ease-out forwards';
                setTimeout(() => {
                    if (document.body.contains(modal)) {
                        document.body.removeChild(modal);
                    }
                }, 300);
                
                // Show success toast
                showSuccessToast();
            }
        }
        
        function showSuccessToast() {
            const toast = document.createElement('div');
            toast.className = 'boost-toast';
            toast.style.background = 'linear-gradient(135deg, #22C55E, #16A34A)';
            toast.innerHTML = `
                <i class="bi bi-check-circle-fill me-2"></i>
                Boost complete! Your WiFi is now optimized.
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (document.body.contains(toast)) {
                    toast.style.animation = 'fadeOut 0.3s ease-out forwards';
                    setTimeout(() => {
                        if (document.body.contains(toast)) {
                            document.body.removeChild(toast);
                        }
                    }, 300);
                }
            }, 4000);
        }

        // Make closeBoostModal globally accessible
        window.closeBoostModal = closeBoostModal;

        // Home Collection Toggle Function
        function toggleAddressFields() {
            const checkbox = document.getElementById('requestHomeCollection');
            const homeCollectionFields = document.getElementById('homeCollectionFields');
            const addressField = document.getElementById('addressField');
            const phoneField = document.getElementById('phoneField');
            const timeField = document.getElementById('timeField');
            const instructionsField = document.getElementById('instructionsField');
            const transactionField = document.querySelector('[name="transaction_id"]').closest('.col-md-6');

            console.log('toggleAddressFields called:', {
                checkboxChecked: checkbox?.checked,
                addressFieldExists: !!addressField,
                phoneFieldExists: !!phoneField,
                timeFieldExists: !!timeField,
                instructionsFieldExists: !!instructionsField,
                homeCollectionFieldsExists: !!homeCollectionFields
            });

            if (checkbox.checked) {
                console.log('Showing home collection fields...');
                
                // Show main container first
                if (homeCollectionFields) {
                    homeCollectionFields.style.display = 'block';
                    homeCollectionFields.style.setProperty('display', 'block', 'important');
                }
                
                // Show individual fields with multiple fallback approaches
                const fieldsToShow = [
                    { element: addressField, name: 'addressField' },
                    { element: phoneField, name: 'phoneField' },
                    { element: timeField, name: 'timeField' },
                    { element: instructionsField, name: 'instructionsField' }
                ];
                
                fieldsToShow.forEach(({ element, name }) => {
                    if (element) {
                        // Multiple approaches to ensure visibility
                        element.style.display = 'block';
                        element.style.setProperty('display', 'block', 'important');
                        element.style.visibility = 'visible';
                        element.style.setProperty('visibility', 'visible', 'important');
                        element.removeAttribute('hidden');
                        element.classList.remove('d-none');
                        console.log(`${name} visibility set to block`);
                    } else {
                        console.warn(`${name} element not found!`);
                    }
                });
                
                // Smooth scroll to the fields
                setTimeout(() => {
                    homeCollectionFields.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
                
                // Show success toast
                const toast = document.createElement('div');
                const isMobile = window.innerWidth <= 768;
                toast.className = isMobile ? 'mobile-toast' : '';
                toast.style.cssText = `
                    position: fixed;
                    top: ${isMobile ? '10px' : '20px'};
                    right: ${isMobile ? '10px' : '20px'};
                    ${isMobile ? 'left: 10px;' : ''}
                    background: linear-gradient(135deg, #10B981, #059669);
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    z-index: 10000;
                    font-weight: 500;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    animation: slideIn 0.3s ease-out;
                    font-size: ${isMobile ? '0.9rem' : '1rem'};
                `;
                toast.innerHTML = '<i class="fas fa-home" style="margin-right: 8px;"></i>Home collection fields activated!';
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.remove();
                }, 3000);
                
                // Hide transaction ID field ONLY for home collection
if (transactionField) {
    transactionField.style.display = 'none';
    const transactionInput = document.getElementById('transaction_id');
    if (transactionInput) {
        transactionInput.required = false;
    }
}
                // Auto-fill user address if available from profile with better debugging
                <% const userAddress = user && user.address; %>
                <% const userPhone = user && user.Number; %>
                
                console.log('Auto-fill data check:', {
                    userExists: '<%= !!user %>',
                    userAddress: '<%= userAddress || "not available" %>',
                    userPhone: '<%= userPhone || "not available" %>'
                });
                
                const addressInputField = document.getElementById('collection_address');
                const contactInputField = document.getElementById('contact_number');
                
                console.log('Input fields found:', {
                    addressField: !!addressInputField,
                    contactField: !!contactInputField
                });
                
                <% if (userAddress) { %>
                if (addressInputField) {
                    try {
                        addressInputField.value = "<%= String(userAddress).replace(/\n/g, '\\n').replace(/"/g, '\\"') %>";
                        addressInputField.style.borderColor = '#10B981';
                        addressInputField.style.backgroundColor = '#F0FDF4';
                        console.log('Address auto-filled successfully:', addressInputField.value);
                    } catch (error) {
                        console.error('Error auto-filling address:', error);
                    }
                } else {
                    console.warn('collection_address input field not found');
                }
                <% } else { %>
                console.log('No user address available for auto-fill');
                <% } %>
                
                <% if (userPhone) { %>
                if (contactInputField) {
                    try {
                        contactInputField.value = "<%= userPhone %>";
                        contactInputField.style.borderColor = '#10B981';
                        contactInputField.style.backgroundColor = '#F0FDF4';
                        console.log('Phone auto-filled successfully:', contactInputField.value);
                    } catch (error) {
                        console.error('Error auto-filling phone:', error);
                    }
                } else {
                    console.warn('contact_number input field not found');
                }
                <% } else { %>
                console.log('No user phone available for auto-fill');
                <% } %>
                
                // Ensure all fields are always editable and visible
                setTimeout(() => {
                    const allFields = [addressInputField, contactInputField];
                    const isMobile = window.innerWidth <= 768;
                    
                    allFields.forEach(field => {
                        if (field) {
                            field.removeAttribute('readonly');
                            field.removeAttribute('disabled');
                            field.style.pointerEvents = 'auto';
                            field.style.userSelect = 'text';
                            if (!field.value) {
                                if (field.id === 'collection_address') {
                                    field.placeholder = isMobile ? "Enter address" : "Please enter your complete address for collection";
                                } else if (field.id === 'contact_number') {
                                    field.placeholder = isMobile ? "Contact number" : "Enter your contact number";
                                }
                            }
                        }
                    });
                    
                    // Also set mobile placeholders for other fields
                    const specialInstructions = document.getElementById('special_instructions');
                    if (specialInstructions && isMobile) {
                        specialInstructions.placeholder = "Special notes";
                    }
                    
                    const preferredTime = document.getElementById('preferred_time');
                    if (preferredTime && isMobile) {
                        preferredTime.placeholder = "Time";
                    }
                    
                    console.log('All fields made editable and mobile-optimized');
                }, 100);
                
                // Show message if data was auto-filled
                <% if (userAddress || (user && user.Number)) { %>
                setTimeout(() => {
                    const toast = document.createElement('div');
                    toast.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: linear-gradient(135deg, #10B981 0%, #059669 100%);
                        color: white;
                        padding: 12px 20px;
                        border-radius: 8px;
                        font-size: 14px;
                        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
                        z-index: 10000;
                        animation: slideIn 0.3s ease-out;
                    `;
                    toast.innerHTML = '<i class="fas fa-check-circle" style="margin-right: 8px;"></i>Profile data auto-filled for home collection';
                    document.body.appendChild(toast);
                    
                    setTimeout(() => {
                        toast.style.animation = 'slideOut 0.3s ease-in forwards';
                        setTimeout(() => document.body.removeChild(toast), 300);
                    }, 3000);
                }, 500);
                <% } %>
                
                // Change button text
                const submitBtn = document.querySelector('[type="submit"]');
                submitBtn.innerHTML = '<i class="fas fa-calendar-check" style="margin-right: 8px;"></i>Schedule Home Collection';
                
                // Update instructions
                const instructionsList = document.querySelector('ol');
                if (instructionsList) {
                    instructionsList.innerHTML = `
                        <li>Fill in your address and contact details</li>
                        <li>Choose your preferred collection time</li>
                        <li>Enter a transaction ID or reference number for tracking</li>
                        <li>Submit the request for home collection</li>
                        <li>Our agent will visit your location to collect payment</li>
                    `;
                }
            } else {
                // Hide home collection fields
                homeCollectionFields.style.display = 'none';
                addressField.style.display = 'none';
                phoneField.style.display = 'none';
                timeField.style.display = 'none';
                instructionsField.style.display = 'none';
                
                // Clear home collection field values when unchecked
                document.getElementById('collection_address').value = '';
                document.getElementById('contact_number').value = '';
                document.getElementById('preferred_time').value = '';
                document.getElementById('special_instructions').value = '';
                
                // Remove or clear hidden home collection input
                const hiddenHomeCollection = document.querySelector('input[name="home_collection"][type="hidden"]');
                if (hiddenHomeCollection) {
                    hiddenHomeCollection.remove();
                }
                
                // Show transaction ID field
                transactionField.style.display = 'block';
                document.getElementById('transaction_id').required = true;
                
                // Reset button text
                const submitBtn = document.querySelector('[type="submit"]');
                submitBtn.innerHTML = '<i class="fas fa-paper-plane" style="margin-right: 8px;"></i>Submit for Verification';
                
                // Reset instructions
                const instructionsList = document.querySelector('ol');
                if (instructionsList) {
                    instructionsList.innerHTML = `
                        <li>Complete payment using any method above</li>
                        <li>Copy the transaction ID from your payment confirmation</li>
                        <li>Enter the transaction ID in the form above</li>
                        <li>Submit for verification and activation</li>
                    `;
                }
            }
        }

        // Debug function to check all home collection elements
        function debugHomeCollectionElements() {
            const elements = {
                checkbox: document.getElementById('requestHomeCollection'),
                mainContainer: document.getElementById('homeCollectionFields'),
                addressField: document.getElementById('addressField'),
                phoneField: document.getElementById('phoneField'),
                timeField: document.getElementById('timeField'),
                instructionsField: document.getElementById('instructionsField'),
                addressInput: document.getElementById('collection_address'),
                contactInput: document.getElementById('contact_number')
            };
            
            console.log('=== HOME COLLECTION DEBUG ===');
            Object.entries(elements).forEach(([name, element]) => {
                if (element) {
                    console.log(`${name}:`, {
                        exists: true,
                        display: getComputedStyle(element).display,
                        visibility: getComputedStyle(element).visibility,
                        opacity: getComputedStyle(element).opacity
                    });
                } else {
                    console.error(`${name}: NOT FOUND`);
                }
            });
            console.log('=== END DEBUG ===');
        }

        // Show home collection fields when home collection card is clicked
        document.addEventListener('DOMContentLoaded', function() {
            // Run debug check on page load
            setTimeout(debugHomeCollectionElements, 1000);
            
            const homeCollectionCard = document.querySelector('[data-bs-target="#homeCollectionInfo"]');
            if (homeCollectionCard) {
                homeCollectionCard.addEventListener('click', function() {
                    // Small delay to let bootstrap collapse animation complete
                    setTimeout(function() {
                        const homeCollectionCheckbox = document.getElementById('requestHomeCollection');
                        if (homeCollectionCheckbox && !homeCollectionCheckbox.checked) {
                            homeCollectionCheckbox.checked = true;
                            toggleAddressFields(); // This will show all the fields
                            
                            // Run debug check after toggle
                            setTimeout(debugHomeCollectionElements, 500);
                        }
                    }, 300);
                });
            }
        });
        
        window.toggleAddressFields = toggleAddressFields;

        // Add form submission handler to ensure home collection data is sent
        document.addEventListener('DOMContentLoaded', function() {
            const paymentForm = document.getElementById('paymentForm');
            if (paymentForm) {
                paymentForm.addEventListener('submit', function(event) {
                    const homeCollectionCheckbox = document.getElementById('requestHomeCollection');
                    const isHomeCollection = homeCollectionCheckbox && homeCollectionCheckbox.checked;
                    
                    console.log('🚀 FORM SUBMIT EVENT TRIGGERED');
                    console.log('🚀 Home collection checkbox checked:', isHomeCollection);
                    console.log('🚀 Checkbox element:', homeCollectionCheckbox);
                    
                    if (isHomeCollection) {
                        // Validate home collection fields
                        const addressField = document.getElementById('collection_address');
                        const contactField = document.getElementById('contact_number');
                        
                        if (!addressField.value.trim()) {
                            event.preventDefault();
                            // Debug info
                            console.log('Address validation failed:', {
                                fieldValue: addressField.value,
                                fieldExists: !!addressField,
                                userAddress: '<%= userAddress || "not found" %>'
                            });
                            alert('Please enter your collection address for home collection service.');
                            addressField.focus();
                            return false;
                        }
                        
                        if (!contactField.value.trim()) {
                            event.preventDefault();
                            alert('Please enter your contact number for home collection service.');
                            contactField.focus();
                            return false;
                        }
                        
                        // Ensure home collection checkbox value is properly set
                        homeCollectionCheckbox.value = 'yes';
                        
                        // Update hidden input to ensure home_collection value is sent
                        const hiddenHomeCollection = document.getElementById('home_collection_hidden');
                        if (hiddenHomeCollection) {
                            hiddenHomeCollection.value = 'yes';
                            console.log('🚀 Updated hidden input to: yes');
                        } else {
                            console.log('🚀 ERROR: Hidden input not found!');
                        }
                        
                        // Debug: Log form data being sent
                        console.log('🏠 Complete Home Collection Form Data:', {
                            home_collection: homeCollectionCheckbox.value,
                            collection_address: addressField.value,
                            contact_number: contactField.value,
                            preferred_time: document.getElementById('preferred_time')?.value || 'not selected',
                            special_instructions: document.getElementById('special_instructions')?.value || 'none'
                        });
                        
                        // Show loading state
                        const submitBtn = this.querySelector('[type="submit"]');
                        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right: 8px;"></i>Scheduling Collection...';
                        submitBtn.disabled = true;
                    } else {
                        // Regular payment submission - ensure home collection data is cleared
                        const hiddenHomeCollection = document.getElementById('home_collection_hidden');
                        if (hiddenHomeCollection) {
                            hiddenHomeCollection.value = 'no';
                            console.log('🚀 Updated hidden input to: no');
                        } else {
                            console.log('🚀 ERROR: Hidden input not found!');
                        }
                        
                        const transactionField = document.getElementById('transaction_id');
                        if (!transactionField.value.trim()) {
                            event.preventDefault();
                            alert('Please enter transaction ID for payment verification.');
                            transactionField.focus();
                            return false;
                        }
                    }
                });
            }
        });
    </script>
    <script src="/vendors/js/vendor.bundle.base.js"></script>
    <script src="/vendors/chart.js/Chart.min.js"></script>
    <script src="/vendors/datatables.net/jquery.dataTables.js"></script>
    <script src="/vendors/datatables.net-bs4/dataTables.bootstrap4.js"></script>
    <script src="/js/dataTables.select.min.js"></script>
    <script src="/js/off-canvas.js"></script>
    <script src="/js/hoverable-collapse.js"></script>
    <script src="/js/template.js"></script>
    <script src="/js/settings.js"></script>
    <script src="/js/dashboard.js"></script>
    <script src="/js/Chart.roundedBarCharts.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>