<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Add Users</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="vendors/feather/feather.css">
    <link rel="stylesheet" href="vendors\ti-icons\css\themify-icons.css">
    <link rel="stylesheet" href="vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <link rel="stylesheet" href="vendors/datatables.net-bs4/dataTables.bootstrap4.css">
    <link rel="stylesheet" href="vendors\ti-icons\css\themify-icons.css">
    <link rel="stylesheet" type="text/css" href="js/select.dataTables.min.css">
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="css/vertical-layout-light/style.css">
    <!-- endinject -->
    <link rel="shortcut icon" href="images/favicon.png" />

    <!-- Material Design Icons CSS -->
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <style>
        /* Equipment Calculation Styles */
        .total-display {
            background-color: #e8f5e8 !important;
            font-weight: bold !important;
            color: #2e7d32 !important;
            border: 2px solid #4caf50 !important;
        }

        .quantity-input, .price-input {
            border: 2px solid #2196f3 !important;
        }

        .quantity-input:focus, .price-input:focus {
            border-color: #1976d2 !important;
            box-shadow: 0 0 0 0.2rem rgba(33, 150, 243, 0.25) !important;
        }

        .dynamic-field {
            transition: all 0.3s ease;
            border: 2px solid #e0e0e0 !important;
        }

        .dynamic-field:hover {
            border-color: #2196f3 !important;
            box-shadow: 0 2px 8px rgba(33, 150, 243, 0.15);
        }

        .equipment-total-card {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            border: 2px solid #2196f3;
            border-radius: 10px;
        }

        .grand-total {
            font-size: 1.2rem !important;
            font-weight: bold !important;
            color: #d32f2f !important;
        }

        .btn-outline-primary {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>

</head>

<body>
    <div class="container-scroller">

        <%- include ('../partials/_navbar.ejs') %>
            <!-- partial -->
            <div class="container-fluid page-body-wrapper" style="padding-left:0% !important; ">                <!-- partial:partials/_settings-panel.html -->
    
                <%- include ('../partials/SettingsDow.ejs') %>
                  <!-- NavBar Start -->
                  <%- include ('../partials/SettingsDow.ejs') %>
                  <%- include ('../partials/Sidebar.ejs') %>
                  <!-- NavBar End -->

                    <div class="card col-md-10 col-lg-10 mx-auto">
                        <div class="card-body">
                                    <!-- sss -->  <!-- sss -->  <!-- sss -->  <!-- sss -->
        <% if (messages.success) { %>
            <div style="display: flex; justify-content: end;"> 
              <div id="pusher-message-box" style="
                display: flex;
                border-left: 8px solid #45439e;
                color: green;
                font-weight: bold;
                font-size: 16px;
                justify-content: end;
                align-items: center;
                height: 70px;
              " class="mt-3 alert alert-primary">
                <%= messages.success %>
              </div>
            </div>
          <% } %>
          <script>
            window.addEventListener('DOMContentLoaded', () => {
              const msgBox = document.getElementById('pusher-message-box');
              if (msgBox) {
                setTimeout(() => {
                  msgBox.style.transition = "opacity 0.5s";
                  msgBox.style.opacity = 0;
                  setTimeout(() => msgBox.style.display = "none", 500);
                }, 4000);
              }
            });
          </script>
          <!-- sss -->  <!-- sss -->  <!-- sss -->  <!-- sss -->
                            <!-- Hero End -->
                            <!-- fibre form submissions-->
                            <div class="container mt-5">
                                <h2 class="mb-4 text-center">All Fibre Form Submissions</h2>
                                <div class="table-responsive shadow rounded p-3 bg-light">
                                    <table
                                        class="table table-bordered table-hover table-striped align-middle text-center">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>#</th>
                                                <th>Email</th>
                                                <th>Device</th>
                                                <th>Device Price</th>
                                                <th>First Package Price</th>
                                                <th>Optical Power</th>
                                                <th>Optical Power Price</th>
                                                <th>Fibre Color</th>
                                                <th>Supplysing</th>
                                                <th> Fibre Cable (core + meter)</th>
                                                <th>Fibre Cable Price </th>
                                                <th>Signal from/Splitter</th>
                                                <th>Duck Patti</th>
                                                <th>Duck Patti Price</th>
                                                <th>Patch Card</th>
                                                <th>Patch Card Price</th>
                                                <th>Custom quantity of patch</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% submissions.forEach((s, i)=> { %>
                                                <tr>
                                                    <td>
                                                        <%= i + 1 %>
                                                    </td>
                                                    <td>
                                                        <%= s.email %>
                                                    </td>
                                                    <td>
                                                        <%= s.device_label %>
                                                    </td>
                                                    <td>
                                                        <%= s.device_price %>
                                                    </td>
                                                    <td>
                                                        <%= s.first_package_price %>
                                                    </td>
                                                    <td>
                                                        <%= s.fibre_power_label %>
                                                    </td>
                                                    <td>
                                                        <%= s.fibre_power_price %>
                                                    </td>
                                                    <td>
                                                        <%= s.fibre_color_value %>
                                                    </td>
                                                    <td>
                                                        <%= s.fibre_supplying_value %>
                                                    </td>
                                                    <td>
                                                        <%= s.cable_label %>
                                                    </td>
                                                    <td>
                                                        <%= s.cable_price %>
                                                    </td>
                                                    <td>
                                                        <%= s.splitter_value %>
                                                    </td>
                                                    <td>
                                                        <%= s.duck_patti_label %>
                                                    </td>
                                                    <td>
                                                        <%= s.duck_patti_price %>
                                                    </td>
                                                    <td>
                                                        <%= s.patch_card_label %>
                                                    </td>
                                                    <td>
                                                        <%= s.patch_card_price %>
                                                    </td>
                                                    <td>
                                                        <%= s.patch_card_custom_quantity %>
                                                    </td>
                                                    <td>
                                                        <button type="button" class="btn btn-sm btn-warning"
                                                            data-bs-toggle="modal"
                                                            data-bs-target="#editModal<%= s.id %>">
                                                            Edit
                                                        </button>

                                                        <form action="/delete-fibre/<%= s.id %>" method="POST"
                                                            style="display:inline;">
                                                            <button type="submit"
                                                                class="btn btn-sm btn-danger">Delete</button>
                                                        </form>
                                                    </td>
                                                </tr>
                                                <!-- // modal for edit -->
                                                <!-- Edit fibre Modal -->
                                                <div class="modal fade" id="editModal<%= s.id %>" tabindex="-1"
                                                    aria-labelledby="editModalLabel<%= s.id %>" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg">
                                                        <form action="/update-fibre/<%= s.id %>" method="POST">
                                                            <div class="modal-content">
                                                                <div class="modal-header bg-warning text-dark">
                                                                    <h5 class="modal-title"
                                                                        id="editModalLabel<%= s.id %>">Edit Fibre
                                                                        Submission (ID: <%= s.id %>)</h5>
                                                                    <button type="button" class="btn-close"
                                                                        data-bs-dismiss="modal"
                                                                        aria-label="Close"></button>
                                                                </div>
                                                                <div class="modal-body row g-3">

                                                                    <div class="col-md-6">
                                                                        <label for="email"
                                                                            class="form-label">Email</label>
                                                                        <input type="email" name="email"
                                                                            class="form-control" value="<%= s.email %>"
                                                                            required>
                                                                    </div>
                                                                    <!-- formType -->
                                                                    <div class="col-md-6">
                                                                        <label class="form-label">User form type</label>
                                                                        <input type="text" name="formType"
                                                                            class="form-control"
                                                                            value="<%= s.formType %>">
                                                                    </div>
                                                                    <!-- formType -->
                                                                    <!-- first package price  -->
                                                                    <div class="col-md-6">
                                                                        <label class="form-label">First Package
                                                                            Price</label>
                                                                        <input type="text" name="first_package_price"
                                                                            class="form-control"
                                                                            value="<%= s.first_package_price %>">
                                                                    </div>
                                                                    <!-- first package price  -->
                                                                    <!-- Device -->
                                                                    <div class="col-md-6">
                                                                        <label class="form-label">Device Name</label>
                                                                        <input list="deviceOptions" name="device_label"
                                                                            class="form-control"
                                                                            value="<%= s.device_label %>" required>
                                                                        <datalist id="deviceOptions">
                                                                            <option value="X-pon">
                                                                            <option value="E-pon">
                                                                            <option value="G-pon">
                                                                        </datalist>
                                                                    </div>

                                                                    <div class="col-md-6">
                                                                        <label class="form-label">Device Price</label>
                                                                        <input type="text" name="device_price"
                                                                            class="form-control"
                                                                            value="<%= s.device_price %>">
                                                                    </div>

                                                                    <!-- Fibre Power -->
                                                                    <div class="col-md-6">
                                                                        <label class="form-label">Fibre Optical
                                                                            Power</label>
                                                                        <select name="fibre_power_label"
                                                                            class="form-select" required>
                                                                            <option value="-10 to -5 dBm"
                                                                                <%=s.fibre_power_label==="-10 to -5 dBm"
                                                                                ? " selected" : "" %>>-10 to -5 dBi
                                                                            </option>
                                                                            <option value="-5 to 0 dBm"
                                                                                <%=s.fibre_power_label==="-5 to 0 dBm"
                                                                                ? " selected" : "" %>>-5 to 0 dBi
                                                                            </option>
                                                                            <option value="0 to +5 dBm"
                                                                                <%=s.fibre_power_label==="0 to +5 dBm"
                                                                                ? " selected" : "" %>>0 to +5 dBi
                                                                            </option>
                                                                            <option value="Custom"
                                                                                <%=s.fibre_power_label==="Custom"
                                                                                ? " selected" : "" %>>Custom</option>
                                                                        </select>
                                                                    </div>

                                                                    <div class="col-md-6">
                                                                        <label class="form-label">Power Price</label>
                                                                        <input type="text" name="fibre_power_price"
                                                                            class="form-control"
                                                                            value="<%= s.fibre_power_price %>">
                                                                    </div>

                                                                    <!-- Fibre Color -->
                                                                    <div class="col-md-6">
                                                                        <label class="form-label">Fibre Color</label>
                                                                        <input type="text" name="fibre_color_value"
                                                                            class="form-control"
                                                                            value="<%= s.fibre_color_value %>">
                                                                    </div>

                                                                    <!-- Supplying -->
                                                                    <div class="col-md-6">
                                                                        <label class="form-label">Fibre
                                                                            Supplying</label>
                                                                        <input type="text" name="fibre_supplying_value"
                                                                            class="form-control"
                                                                            value="<%= s.fibre_supplying_value %>">
                                                                    </div>

                                                                    <!-- Cable -->
                                                                    <div class="col-md-6">
                                                                        <label class="form-label">Cable (Label)</label>
                                                                        <input type="text" name="cable_label"
                                                                            class="form-control"
                                                                            value="<%= s.cable_label %>">
                                                                    </div>

                                                                    <div class="col-md-6">
                                                                        <label class="form-label">Cable Price</label>
                                                                        <input type="text" name="cable_price"
                                                                            class="form-control"
                                                                            value="<%= s.cable_price %>">
                                                                    </div>

                                                                    <!-- Splitter -->
                                                                    <div class="col-md-6">
                                                                        <label class="form-label">Splitter</label>
                                                                        <select name="splitter_value"
                                                                            class="form-select">
                                                                            <option value="2way"
                                                                                <%=s.splitter_value==="2way"
                                                                                ? "selected" : "" %>>2 Way</option>
                                                                            <option value="4way"
                                                                                <%=s.splitter_value==="4way"
                                                                                ? "selected" : "" %>>4 Way</option>
                                                                            <option value="8way"
                                                                                <%=s.splitter_value==="8way"
                                                                                ? "selected" : "" %>>8 Way</option>
                                                                            <option value="12way"
                                                                                <%=s.splitter_value==="12way"
                                                                                ? "selected" : "" %>>12 Way</option>
                                                                        </select>
                                                                    </div>

                                                                    <!-- Duck Patti -->
                                                                    <div class="col-md-4">
                                                                        <label class="form-label">Duck Patti
                                                                            Quantity</label>
                                                                        <input type="number" name="duck_patti_label"
                                                                            class="form-control quantity-input"
                                                                            value="<%= s.duck_patti_label %>"
                                                                            data-price-target="duck_patti_price"
                                                                            data-total-target="duck_patti_total">
                                                                    </div>

                                                                    <div class="col-md-4">
                                                                        <label class="form-label">Duck Patti Unit
                                                                            Price</label>
                                                                        <input type="number" name="duck_patti_price"
                                                                            class="form-control price-input"
                                                                            value="<%= s.duck_patti_price %>"
                                                                            data-quantity-target="duck_patti_label"
                                                                            data-total-target="duck_patti_total">
                                                                    </div>

                                                                    <div class="col-md-4">
                                                                        <label class="form-label">Duck Patti Total</label>
                                                                        <input type="number" name="duck_patti_total"
                                                                            class="form-control total-display"
                                                                            id="duck_patti_total" readonly
                                                                            style="background-color: #f8f9fa; font-weight: bold;">
                                                                    </div>

                                                                    <!-- Patch Card -->
                                                                    <div class="col-md-4">
                                                                        <label class="form-label">Patch Card
                                                                            Quantity</label>
                                                                        <input type="number" name="patch_card_label"
                                                                            class="form-control quantity-input"
                                                                            value="<%= s.patch_card_label %>"
                                                                            data-price-target="patch_card_price"
                                                                            data-total-target="patch_card_total">
                                                                    </div>

                                                                    <div class="col-md-4">
                                                                        <label class="form-label">Patch Card Unit
                                                                            Price</label>
                                                                        <input type="number" name="patch_card_price"
                                                                            class="form-control price-input"
                                                                            value="<%= s.patch_card_price %>"
                                                                            data-quantity-target="patch_card_label"
                                                                            data-total-target="patch_card_total">
                                                                    </div>

                                                                    <div class="col-md-4">
                                                                        <label class="form-label">Patch Card Total</label>
                                                                        <input type="number" name="patch_card_total"
                                                                            class="form-control total-display"
                                                                            id="patch_card_total" readonly
                                                                            style="background-color: #f8f9fa; font-weight: bold;">
                                                                    </div>

                                                                    <div class="col-md-12">
                                                                        <label class="form-label">Custom Patch Card
                                                                            Notes</label>
                                                                        <input type="text" name="patch_card_custom_quantity"
                                                                            class="form-control"
                                                                            value="<%= s.patch_card_custom_quantity %>"
                                                                            placeholder="Additional notes for patch cards">
                                                                    </div>

                                                                    <!-- Dynamic Equipment Fields Container -->
                                                                    <div id="dynamicFieldsContainer<%= s.id %>" class="col-md-12 mt-4">
                                                                        <h6 class="fw-bold text-primary mb-3">
                                                                            <i class="fas fa-tools"></i> Additional Equipment
                                                                        </h6>
                                                                        <div id="dynamicFields<%= s.id %>">
                                                                            <!-- Dynamic fields will be added here -->
                                                                        </div>
                                                                        <button type="button" class="btn btn-outline-primary btn-sm mt-2" 
                                                                                onclick="addEquipmentField('<%= s.id %>')">
                                                                            <i class="fas fa-plus"></i> Add Equipment Field
                                                                        </button>
                                                                    </div>

                                                                    <!-- Total Cost Display -->
                                                                    <div class="col-md-12 mt-4">
                                                                        <div class="card bg-light">
                                                                            <div class="card-body">
                                                                                <h6 class="card-title text-success">
                                                                                    <i class="fas fa-calculator"></i> Total Equipment Cost
                                                                                </h6>
                                                                                <div class="row">
                                                                                    <div class="col-md-4">
                                                                                        <label class="form-label">Duck Patti Total</label>
                                                                                        <div class="fw-bold text-primary" id="display_duck_patti_total<%= s.id %>">₹0</div>
                                                                                    </div>
                                                                                    <div class="col-md-4">
                                                                                        <label class="form-label">Patch Card Total</label>
                                                                                        <div class="fw-bold text-primary" id="display_patch_card_total<%= s.id %>">₹0</div>
                                                                                    </div>
                                                                                    <div class="col-md-4">
                                                                                        <label class="form-label">Grand Total</label>
                                                                                        <div class="fw-bold text-success fs-5" id="grandTotal<%= s.id %>">₹0</div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                </div>
                                                                <div class="modal-footer">
                                                                    <button type="button" class="btn btn-danger me-2" data-bs-dismiss="modal" style="background-color: #dc3545; border: none; border-radius: 25px;">
                                                                        <i class="fas fa-times me-2"></i>Cancel
                                                                    </button>
                                                                    <button type="submit" class="btn btn-success" style="background-color: #28a745; border: none; border-radius: 25px;">
                                                                        <i class="fas fa-save me-2"></i>Update Fibre Submission
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                                <!-- Edit fibre Modal -->

                                                <% }) %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- fibre form submissions-->
                            <!-- wireless form submissions  -->
                            <div class="container mt-5">
                                <h3>Wireless Form Submissions</h3>
                                <div class="table-responsive">
                                    <table class="table table-bordered table-striped text-nowrap">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>Email</th>
                                                <th>Cat 6 Meter</th>
                                                <th>Cat 6 Price</th>
                                                <th>First Package Price</th>
                                                <th>Clips Count</th>
                                                <th>Clips Price</th>
                                                <th>Raval Bold Pair</th>
                                                <th>Raval Bold Price</th>
                                                <th>Poll Height</th>
                                                <th>Poll Price</th>
                                                <th>Signal Strength</th>
                                                <th>Home Tower Height</th>
                                                <th>Signal Receiver</th>
                                                <th>Receiver Price</th>
                                                <th>Receiver Model</th>
                                                <th>WiFi ONU</th>
                                                <th>ONU Price</th>
                                                <th>ONU Model</th>
                                                <th>Tower AP Device</th>
                                                <th>Wireless Field</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% wirelessForms.forEach(form=> { %>
                                                <tr>
                                                    <td>
                                                        <%= form.email %>
                                                    </td>
                                                    <td>
                                                        <%= form.cat6_meter %>
                                                    </td>
                                                    <td>Rs.<%= form.cat6_price %>
                                                    </td>
                                                    <td>
                                                        <%= form.first_package_price %>
                                                    </td>
                                                    <td>
                                                        <%= form.clips_count %>
                                                    </td>
                                                    <td>Rs.<%= form.clips_price %>
                                                    </td>
                                                    <td>
                                                        <%= form.raval_bold_pair %>
                                                    </td>
                                                    <td>Rs.<%= form.raval_bold_price %>
                                                    </td>
                                                    <td>
                                                        <%= form.poll_height %>
                                                    </td>
                                                    <td>Rs.<%= form.poll_price %>
                                                    </td>
                                                    <td>
                                                        <%= form.signal_strength %>
                                                    </td>
                                                    <td>
                                                        <%= form.home_tower_height %>
                                                    </td>
                                                    <td>
                                                        <%= form.signal_receiver %>
                                                    </td>
                                                    <td>Rs.<%= form.receiver_price %>
                                                    </td>
                                                    <td>
                                                        <%= form.receiver_model %>
                                                    </td>
                                                    <td>
                                                        <%= form.wifi_onu %>
                                                    </td>
                                                    <td>Rs.<%= form.onu_price %>
                                                    </td>
                                                    <td>
                                                        <%= form.onu_model %>
                                                    </td>
                                                    <td>
                                                        <%= form.tower_ap_device %>
                                                    </td>
                                                    <td>
                                                        <%= form.wireless_field %>
                                                    </td>
                                                    <td>
                                                        <button class="btn btn-sm btn-primary" data-bs-toggle="modal"
                                                            data-bs-target="#editWirelessModal<%= form.id %>">Edit</button>
                                                        <form action="/delete-wireless/<%= form.id %>" method="POST"
                                                            class="d-inline">
                                                            <button class="btn btn-sm btn-danger">Delete</button>
                                                        </form>
                                                    </td>
                                                </tr>
                                                <!-- wireless modal form -->
                                                <!-- Edit Wireless Modal -->
                                                <div class="modal fade" id="editWirelessModal<%= form.id %>"
                                                    tabindex="-1" aria-labelledby="editModalLabel<%= form.id %>"
                                                    aria-hidden="true">
                                                    <div class="modal-dialog modal-xl modal-dialog-centered">
                                                        <form action="/update-wireless/<%= form.id %>" method="POST">
                                                            <div class="modal-content border-0 shadow-lg rounded-4">
                                                                <div
                                                                    class="modal-header bg-primary text-white rounded-top-4">
                                                                    <h5 class="modal-title">Edit Wireless Form</h5>
                                                                    <button type="button"
                                                                        class="btn-close btn-close-white"
                                                                        data-bs-dismiss="modal"
                                                                        aria-label="Close"></button>
                                                                </div>

                                                                <div class="modal-body p-4">
                                                                    
                                                                    <input type="hidden" name="email"
                                                                        value="<%= form.email %>">

                                                                    <!-- Row 1: Cat 6 -->
                                                                    <div class="row mb-3">
                                                                        <div class="col-md-4">
                                                                            <label class="form-label">Cat 6 Wire
                                                                                (Meters)</label>
                                                                            <input type="number" name="cat6_meter"
                                                                                class="form-control quantity-input"
                                                                                value="<%= form.cat6_meter %>"
                                                                                data-price-target="cat6_price"
                                                                                data-total-target="cat6_total">
                                                                        </div>
                                                                        <div class="col-md-4">
                                                                            <label class="form-label">Cat 6 Unit Price
                                                                                (Rs)</label>
                                                                            <input type="number" name="cat6_price"
                                                                                class="form-control price-input"
                                                                                value="<%= form.cat6_price %>"
                                                                                data-quantity-target="cat6_meter"
                                                                                data-total-target="cat6_total">
                                                                        </div>
                                                                        <div class="col-md-4">
                                                                            <label class="form-label">Cat 6 Total</label>
                                                                            <input type="number" name="cat6_total"
                                                                                class="form-control total-display"
                                                                                id="cat6_total" readonly
                                                                                style="background-color: #f8f9fa; font-weight: bold;">
                                                                        </div>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <label class="form-label">User form
                                                                            type</label>
                                                                        <input type="text" name="formType"
                                                                            class="form-control"
                                                                            value="<%= form.formType %>">
                                                                   </div>
                                                                    <!-- First Package Price -->
                                                                    <div class="row mb-3">
                                                                        <div class="col-md-6">
                                                                            <label class="form-label">First Package
                                                                                Price (Rs)</label>
                                                                            <input type="number"
                                                                                name="first_package_price"
                                                                                class="form-control"
                                                                                value="<%= form.first_package_price %>">
                                                                        </div>
                                                                    </div>
                                                                    <!-- Row 2: Clips -->
                                                                    <div class="row mb-3">
                                                                        <div class="col-md-4">
                                                                            <label class="form-label">Number of
                                                                                Clips</label>
                                                                            <input type="number" name="clips_count"
                                                                                class="form-control quantity-input"
                                                                                value="<%= form.clips_count %>"
                                                                                data-price-target="clips_price"
                                                                                data-total-target="clips_total">
                                                                        </div>
                                                                        <div class="col-md-4">
                                                                            <label class="form-label">Clips Unit Price
                                                                                (Rs)</label>
                                                                            <input type="number" name="clips_price"
                                                                                class="form-control price-input"
                                                                                value="<%= form.clips_price %>"
                                                                                data-quantity-target="clips_count"
                                                                                data-total-target="clips_total">
                                                                        </div>
                                                                        <div class="col-md-4">
                                                                            <label class="form-label">Clips Total</label>
                                                                            <input type="number" name="clips_total"
                                                                                class="form-control total-display"
                                                                                id="clips_total" readonly
                                                                                style="background-color: #f8f9fa; font-weight: bold;">
                                                                        </div>
                                                                    </div>

                                                                    <!-- Row 3: Raval Bold -->
                                                                    <div class="row mb-3">
                                                                        <div class="col-md-6">
                                                                            <label class="form-label">Raval Bold
                                                                                Pair</label>
                                                                            <select name="raval_bold_pair"
                                                                                class="form-select">
                                                                                <% for(let i=1; i <=10; i++) { %>
                                                                                    <option value="<%= i %>"
                                                                                        <%=form.raval_bold_pair==i
                                                                                        ? 'selected' : '' %>><%= i %>
                                                                                            Pair</option>
                                                                                    <% } %>
                                                                            </select>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <label class="form-label">Raval Bold Price
                                                                                (Rs)</label>
                                                                            <input type="number" name="raval_bold_price"
                                                                                class="form-control"
                                                                                value="<%= form.raval_bold_price %>">
                                                                        </div>
                                                                    </div>

                                                                    <!-- Row 4: Poll -->
                                                                    <div class="row mb-3">
                                                                        <div class="col-md-6">
                                                                            <label class="form-label">Poll
                                                                                Height</label>
                                                                            <select name="poll_height"
                                                                                class="form-select">
                                                                                <% ["10 feet", "20 feet" , "30 feet"
                                                                                    , "40 feet" , "50 feet"
                                                                                    ].forEach(height=> { %>
                                                                                    <option value="<%= height %>"
                                                                                        <%=form.poll_height===height
                                                                                        ? 'selected' : '' %>><%= height
                                                                                            %>
                                                                                    </option>
                                                                                    <% }) %>
                                                                            </select>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <label class="form-label">Poll Price
                                                                                (Rs)</label>
                                                                            <input type="number" name="poll_price"
                                                                                class="form-control"
                                                                                value="<%= form.poll_price %>">
                                                                        </div>
                                                                    </div>

                                                                    <!-- Row 5: Signal + Tower Height -->
                                                                    <div class="row mb-3">
                                                                        <div class="col-md-6">
                                                                            <label class="form-label">Signal Strength
                                                                                (dBi)</label>
                                                                            <div class="input-group">
                                                                                <input type="number"
                                                                                    name="signal_strength"
                                                                                    class="form-control"
                                                                                    value="<%= form.signal_strength %>">
                                                                                <span
                                                                                    class="input-group-text">-dBi</span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="col-md-6">
                                                                            <label class="form-label">Home Tower
                                                                                Height</label>
                                                                            <select name="home_tower_height"
                                                                                class="form-select">
                                                                                <% for(let i=20; i <=70; i +=5) { %>
                                                                                    <option value="<%= i %>-<%= i+5 %>"
                                                                                        <%=form.home_tower_height===`${i}-${i+5}`
                                                                                        ? 'selected' : '' %>><%= i %>-
                                                                                            <%= i+5 %>
                                                                                    </option>
                                                                                    <% } %>
                                                                            </select>
                                                                        </div>
                                                                    </div>

                                                                    <!-- Row 6: Receiver -->
                                                                    <div class="row mb-3">
                                                                        <div class="col-md-4">
                                                                            <label class="form-label">Signal
                                                                                Receiver</label>
                                                                            <select name="signal_receiver"
                                                                                class="form-select">
                                                                                <% ["Light Beam-M5", "Light Beam-AC"
                                                                                    , "Power Beam-M5" , "Power Beam-AC"
                                                                                    , "Nano-station" , "Outdoor Router"
                                                                                    , "Other" ].forEach(r=> { %>
                                                                                    <option value="<%= r %>"
                                                                                        <%=form.signal_receiver===r
                                                                                        ? 'selected' : '' %>><%= r %>
                                                                                    </option>
                                                                                    <% }) %>
                                                                            </select>
                                                                        </div>
                                                                        <div class="col-md-4">
                                                                            <label class="form-label">Receiver Price
                                                                                (Rs)</label>
                                                                            <input type="text" name="receiver_price"
                                                                                class="form-control"
                                                                                value="<%= form.receiver_price %>">
                                                                        </div>
                                                                        <div class="col-md-4">
                                                                            <label class="form-label">Receiver
                                                                                Model</label>
                                                                            <input type="text" name="receiver_model"
                                                                                class="form-control"
                                                                                value="<%= form.receiver_model %>">
                                                                        </div>
                                                                    </div>

                                                                    <!-- Row 7: ONU -->
                                                                    <div class="row mb-3">
                                                                        <div class="col-md-4">
                                                                            <label class="form-label">WiFi ONU</label>
                                                                            <select name="wifi_onu" class="form-select">
                                                                                <% ["TP-Link", "China" , "Net gear"
                                                                                    , "Other" ].forEach(o=> { %>
                                                                                    <option value="<%= o %>"
                                                                                        <%=form.wifi_onu===o
                                                                                        ? 'selected' : '' %>><%= o %>
                                                                                    </option>
                                                                                    <% }) %>
                                                                            </select>
                                                                        </div>
                                                                        <div class="col-md-4">
                                                                            <label class="form-label">ONU Price
                                                                                (Rs)</label>
                                                                            <input type="text" name="onu_price"
                                                                                class="form-control"
                                                                                value="<%= form.onu_price %>">
                                                                        </div>
                                                                        <div class="col-md-4">
                                                                            <label class="form-label">ONU Model</label>
                                                                            <input type="text" name="onu_model"
                                                                                class="form-control"
                                                                                value="<%= form.onu_model %>">
                                                                        </div>
                                                                    </div>

                                                                    <!-- Row 8: Tower AP Device -->
                                                                    <div class="mb-3">
                                                                        <label class="form-label">Tower AP
                                                                            Device</label>
                                                                        <select name="tower_ap_device"
                                                                            class="form-select">
                                                                            <% ["Fibrish", "Click Opticx" , "D-11"
                                                                                , "Other" ].forEach(d=> { %>
                                                                                <option value="<%= d %>"
                                                                                    <%=form.tower_ap_device===d
                                                                                    ? 'selected' : '' %>><%= d %>
                                                                                </option>
                                                                                <% }) %>
                                                                        </select>
                                                                    </div>

                                                                    <!-- Optional Notes -->
                                                                    <div class="mb-3">
                                                                        <label class="form-label">Optional Notes</label>
                                                                        <input type="text" name="wireless_field"
                                                                            class="form-control"
                                                                            value="<%= form.wireless_field %>">
                                                                    </div>

                                                                    <!-- Dynamic Equipment Fields Container for Wireless -->
                                                                    <div class="mb-4">
                                                                        <h6 class="fw-bold text-primary mb-3">
                                                                            <i class="fas fa-tools"></i> Additional Equipment
                                                                        </h6>
                                                                        <div id="dynamicFields<%= form.id %>">
                                                                            <!-- Dynamic fields will be added here -->
                                                                        </div>
                                                                        <button type="button" class="btn btn-outline-primary btn-sm mt-2" 
                                                                                onclick="addEquipmentField('<%= form.id %>')">
                                                                            <i class="fas fa-plus"></i> Add Equipment Field
                                                                        </button>
                                                                    </div>

                                                                    <!-- Total Cost Display for Wireless -->
                                                                    <div class="mb-3">
                                                                        <div class="card bg-light">
                                                                            <div class="card-body">
                                                                                <h6 class="card-title text-success">
                                                                                    <i class="fas fa-calculator"></i> Total Equipment Cost
                                                                                </h6>
                                                                                <div class="row">
                                                                                    <div class="col-md-4">
                                                                                        <label class="form-label">Cat 6 Total</label>
                                                                                        <div class="fw-bold text-primary" id="display_cat6_total<%= form.id %>">₹0</div>
                                                                                    </div>
                                                                                    <div class="col-md-4">
                                                                                        <label class="form-label">Clips Total</label>
                                                                                        <div class="fw-bold text-primary" id="display_clips_total<%= form.id %>">₹0</div>
                                                                                    </div>
                                                                                    <div class="col-md-4">
                                                                                        <label class="form-label">Grand Total</label>
                                                                                        <div class="fw-bold text-success fs-5" id="grandTotal<%= form.id %>">₹0</div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                                <div class="modal-footer bg-light">
                                                                    <button type="button" class="btn btn-danger me-2" data-bs-dismiss="modal" style="background-color: #dc3545; border: none; border-radius: 25px;">
                                                                        <i class="fas fa-times me-2"></i>Cancel
                                                                    </button>
                                                                    <button type="submit" class="btn btn-success" style="background-color: #28a745; border: none; border-radius: 25px;">
                                                                        <i class="fas fa-save me-2"></i>Update Wireless Form
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>

                                                <!-- wireless modal form -->

                                                <!-- Include Edit Modal -->
                                                <% }); %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>


                            <!-- wireless form submissions  -->
                        </div>
                    </div>
            </div>




    </div>
    <!-- Update Modal End --><!-- Update Modal End -->

    <!-- plugins:js -->
    <script src="vendors\js\vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="vendors\chart.js/Chart.min.js"></script>
    <script src="vendors/datatables.net/jquery.dataTables.js"></script>
    <script src="vendors/datatables.net-bs4/dataTables.bootstrap4.js"></script>
    <script src="js/dataTables.select.min.js"></script>

    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="js/off-canvas.js"></script>
    <script src="js/hoverable-collapse.js"></script>
    <script src="js/template.js"></script>
    <script src="js/settings.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page-->
    <script src="js/dashboard.js"></script>
    <script src="js/Chart.roundedBarCharts.js"></script>
    <!-- End custom js for this page-->
    <!-- Bootstrap  -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Dynamic Equipment Calculation Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize price calculations for all existing modals
            initializePriceCalculations();
            
            // Calculate initial totals
            calculateAllTotals();
            
            // Add modal show event listeners
            document.querySelectorAll('.modal').forEach(function(modal) {
                modal.addEventListener('shown.bs.modal', function() {
                    // Re-initialize calculations when modal opens
                    initializePriceCalculations();
                    calculateAllTotals();
                });
            });
        });

        function initializePriceCalculations() {
            // Add event listeners to all quantity and price inputs
            document.querySelectorAll('.quantity-input, .price-input').forEach(function(input) {
                // Remove existing listeners first
                input.removeEventListener('input', handleInputChange);
                input.removeEventListener('keyup', handleInputChange);
                input.removeEventListener('change', handleInputChange);
                
                // Add new listeners
                input.addEventListener('input', handleInputChange);
                input.addEventListener('keyup', handleInputChange);
                input.addEventListener('change', handleInputChange);
            });
        }

        function handleInputChange() {
            calculatePrice(this);
            updateGrandTotal(this);
        }

        function calculatePrice(input) {
            const form = input.closest('form');
            const modal = input.closest('.modal');
            const modalId = modal?.id.replace('editModal', '').replace('editWirelessModal', '');
            
            const priceTarget = input.getAttribute('data-price-target');
            const quantityTarget = input.getAttribute('data-quantity-target');
            const totalTarget = input.getAttribute('data-total-target');
            
            if (!totalTarget || !form) return;
            
            let quantity = 0;
            let price = 0;
            
            if (priceTarget) {
                // This is a quantity input
                quantity = parseFloat(input.value) || 0;
                const priceInput = form.querySelector(`input[name="${priceTarget}"]`);
                price = parseFloat(priceInput?.value) || 0;
                console.log(`Quantity: ${quantity}, Price: ${price}, Target: ${totalTarget}`);
            } else if (quantityTarget) {
                // This is a price input
                price = parseFloat(input.value) || 0;
                const quantityInput = form.querySelector(`input[name="${quantityTarget}"]`);
                quantity = parseFloat(quantityInput?.value) || 0;
                console.log(`Price: ${price}, Quantity: ${quantity}, Target: ${totalTarget}`);
            }
            
            const total = quantity * price;
            console.log(`Calculated total: ${total}`);
            
            // Update the total input field
            const totalInput = form.querySelector(`input[name="${totalTarget}"]`);
            if (totalInput) {
                totalInput.value = total.toFixed(2);
                console.log(`Updated total input: ${totalInput.value}`);
            }
            
            // Update display elements
            updateTotalDisplay(totalTarget.replace('_total', ''), total, modalId);
        }

        function updateTotalDisplay(fieldName, total, modalId) {
            const displayElement = document.getElementById(`display_${fieldName}_total${modalId}`);
            if (displayElement) {
                displayElement.textContent = `₹${total.toFixed(2)}`;
            }
        }

        function updateGrandTotal(input) {
            const form = input.closest('form');
            const modalId = input.closest('.modal')?.id.replace('editModal', '').replace('editWirelessModal', '');
            
            let grandTotal = 0;
            
            // Sum all total fields
            form.querySelectorAll('.total-display').forEach(function(totalInput) {
                const value = parseFloat(totalInput.value) || 0;
                grandTotal += value;
            });
            
            // Sum dynamic fields
            form.querySelectorAll('.dynamic-total').forEach(function(totalInput) {
                const value = parseFloat(totalInput.value) || 0;
                grandTotal += value;
            });
            
            const grandTotalElement = document.getElementById(`grandTotal${modalId}`);
            if (grandTotalElement) {
                grandTotalElement.textContent = `₹${grandTotal.toFixed(2)}`;
            }
        }

        function calculateAllTotals() {
            // Calculate initial totals for all forms
            document.querySelectorAll('.quantity-input, .price-input').forEach(function(input) {
                calculatePrice(input);
            });
            
            document.querySelectorAll('.quantity-input, .price-input').forEach(function(input) {
                updateGrandTotal(input);
            });
        }

        let dynamicFieldCounter = 0;

        function addEquipmentField(modalId) {
            dynamicFieldCounter++;
            const container = document.getElementById(`dynamicFields${modalId}`);
            
            if (!container) {
                console.error(`Container dynamicFields${modalId} not found`);
                return;
            }
            
            const fieldId = `dynamic_${modalId}_${dynamicFieldCounter}`;
            
            const fieldHTML = `
                <div class="row mb-3 dynamic-field border rounded p-3 bg-light" id="field_${fieldId}">
                    <div class="col-md-12 mb-2">
                        <h6 class="text-primary mb-2">
                            <i class="fas fa-plus-circle"></i> Additional Equipment #${dynamicFieldCounter}
                        </h6>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Equipment Name</label>
                        <input type="text" name="dynamic_name_${fieldId}" class="form-control" 
                               placeholder="e.g. Cable, Router, Switch">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Quantity</label>
                        <input type="number" name="dynamic_quantity_${fieldId}" 
                               class="form-control quantity-input dynamic-quantity" 
                               data-price-target="dynamic_price_${fieldId}"
                               data-total-target="dynamic_total_${fieldId}"
                               placeholder="0" min="0" step="1">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Unit Price (₹)</label>
                        <input type="number" name="dynamic_price_${fieldId}" 
                               class="form-control price-input dynamic-price" 
                               data-quantity-target="dynamic_quantity_${fieldId}"
                               data-total-target="dynamic_total_${fieldId}"
                               placeholder="0.00" min="0" step="0.01">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">Total Amount</label>
                        <input type="number" name="dynamic_total_${fieldId}" 
                               class="form-control total-display dynamic-total" 
                               readonly 
                               style="background-color: #e3f2fd; font-weight: bold; color: #1976d2;"
                               placeholder="0.00">
                    </div>
                    <div class="col-md-1 d-flex align-items-end">
                        <button type="button" class="btn btn-danger btn-sm" 
                                onclick="removeEquipmentField('field_${fieldId}', '${modalId}')"
                                title="Remove this equipment">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', fieldHTML);
            
            // Add event listeners to new fields
            const newField = document.getElementById(`field_${fieldId}`);
            if (newField) {
                newField.querySelectorAll('.quantity-input, .price-input').forEach(function(input) {
                    input.addEventListener('input', handleInputChange);
                    input.addEventListener('keyup', handleInputChange);
                    input.addEventListener('change', handleInputChange);
                });
                
                console.log(`Added equipment field ${fieldId} to modal ${modalId}`);
            }
        }

        function removeEquipmentField(fieldId, modalId) {
            const field = document.getElementById(fieldId);
            if (field) {
                field.remove();
                // Recalculate grand total after removing field
                const form = document.querySelector(`#editModal${modalId} form, #editWirelessModal${modalId} form`);
                if (form) {
                    const firstInput = form.querySelector('.quantity-input, .price-input');
                    if (firstInput) {
                        updateGrandTotal(firstInput);
                    }
                }
            }
        }

        // Save equipment data to show in user profile
        function saveEquipmentToProfile(formData, email) {
            // This function can be called when form is submitted
            // to save equipment data for display in user profile
            const equipmentData = {
                email: email,
                equipmentCosts: {},
                grandTotal: 0
            };
            
            // Extract equipment costs from form
            const form = formData.target || formData;
            form.querySelectorAll('.total-display').forEach(function(input) {
                const fieldName = input.name.replace('_total', '');
                const value = parseFloat(input.value) || 0;
                equipmentData.equipmentCosts[fieldName] = value;
                equipmentData.grandTotal += value;
            });
            
            // Store in localStorage for now (can be sent to server)
            const existingData = JSON.parse(localStorage.getItem('userEquipmentCosts') || '{}');
            existingData[email] = equipmentData;
            localStorage.setItem('userEquipmentCosts', JSON.stringify(existingData));
        }

        // Optional: Add form submission handler to save data
        document.querySelectorAll('form[action*="update-fibre"], form[action*="update-wireless"]').forEach(function(form) {
            form.addEventListener('submit', function(e) {
                const email = this.querySelector('input[name="email"]').value;
                saveEquipmentToProfile(this, email);
            });
        });
    </script>
</body>

</html>