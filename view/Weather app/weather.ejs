<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Weather</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="vendors/feather/feather.css">
    <link rel="stylesheet" href="vendors\ti-icons\css\themify-icons.css">
    <link rel="stylesheet" href="vendors/css/vendor.bundle.base.css">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <link rel="stylesheet" href="vendors/datatables.net-bs4/dataTables.bootstrap4.css">
    <link rel="stylesheet" href="vendors\ti-icons\css\themify-icons.css">
    <link rel="stylesheet" type="text/css" href="js/select.dataTables.min.css">
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="css/vertical-layout-light/style.css">
    <!-- endinject -->
    <link rel="shortcut icon" href="images/favicon.png" />

    <!-- Material Design Icons CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">

    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        .card {
            width: 90%;
            max-width: 470px;
            background: linear-gradient(135deg, #00feba, #5b548a);
            color: #fff;

            border-radius: 20px;
            padding: 40px 35px;
            text-align: center;
        }

        .search {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .search input {
            border: 0;
            outline: 0;
            background: #ebfffc;
            color: #555;
            padding: 10px 25px;
            height: 60px;
            border-radius: 30px;
            flex: 1;
            margin-right: 16px;
            font-size: 18px;
        }

        .search button {
            border: 0;
            outline: 0;
            background: #ebfffc;
            border-radius: 50px;
            width: 60px;
            height: 60px;
            cursor: pointer;
        }

        .search button img {
            width: 16px;
        }

        .weather-icon {
            width: 170px;
            margin-top: 30px;
        }

        .weather h1 {
            font-size: 80px;
            font-weight: 500;
        }

        .weather h2 {
            font-size: 45px;
            font-weight: 400;
            margin-top: -10px;
        }

        .details {
            display: flex;
            justify-content: space-between;
            padding: 0px 20px;
            margin-top: 50px;
        }

        .col {
            display: flex;
            align-items: center;
            text-align: left;
        }

        .col img {
            width: 40px;
            margin-right: 10px;
        }

        .humidity,
        .wind {
            font-size: 28px;
            margin-top: -6px;
        }

        .loading {
            display: none;
            margin-top: 20px;
            font-size: 18px;
            color: #fff;
        }
    </style>
</head>

<body>
    <div class="container-scroller">
        <!-- partial:partials/_navbar -->
        <%- include ('../partials/_navbar.ejs') %>
            <div class="container-fluid page-body-wrapper">
                <!-- partial:partials/_navbar -->
                <nav class="sidebar sidebar-offcanvas" id="sidebar">
                    <ul class="nav">
                        <li class="nav-item">
                            <a class="nav-link" href="/index">
                                <i class="icon-grid menu-icon"></i>
                                <span class="menu-title">Dashboard</span>
                            </a>
                        </li>


                        <li class="nav-item">
                            <a class="nav-link" href="/package">
                                <i class="mdi mdi-cast"></i>
                                <span class="menu-title pl-2">All Packages</span>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/History">
                                <i class="mdi mdi-alarm-multiple"></i>
                                <span class="menu-title pl-2">History</span>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/complaint">
                                <i class="bi bi-wallet2"></i>
                                <span class="menu-title pl-2">Wallet </span>
                            </a>
                        </li>


                        <li class="nav-item">
                            <a class="nav-link" href="/profile">
                                <i class="mdi mdi-account"></i>
                                <span class="menu-title pl-2">Profile</span>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/contactus">
                                <i class="mdi mdi-phone"></i>
                                <span class="menu-title pl-2">Contact Us</span>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/changepassword">
                                <i class="bi bi-house-lock"></i>
                                <span class="menu-title pl-2">Change Wifi Password</span>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/logout">
                                <i class="mdi mdi-logout"></i>
                                <span class="menu-title pl-2">Logout</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                <!-- NavBar End -->

                <div class="main-panel"
                    style="background-image: url('images/weather bg.jpg'); background-size: cover; background-position: center;">


                    <div class="content-wrapper">
                        <!-- Hero start -->
                        <!-- Weather -->

                        <div class="container mt-5" style="display: flex; justify-content: center;">

                            <div class="card">
                                <div class="search">
                                    <input type="text" placeholder="Enter your city name" spellcheck="false">
                                    <button><img src="images/search.png" alt="Search"></button>
                                </div>
                                <div class="loading">Detecting your location...</div>
                                <div class="weather">
                                    <img src="images/clear.png" class="weather-icon" alt="Weather Icon">
                                    <h1 class="temp">--°C</h1>
                                    <h2 class="city">City</h2>
                                    <div class="details">
                                        <div class="col">
                                            <img src="images/humidity.png" alt="Humidity">
                                            <div>
                                                <p class="humidity">--%</p>
                                                <p>Humidity</p>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <img src="images/wind.png" alt="Wind Speed">
                                            <div>
                                                <p class="wind">-- km/h</p>
                                                <p>Wind Speed</p>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <script>
                                const apiKey = "f2d781b13e5a447892774059252105";
                                const apiUrl = "http://api.weatherapi.com/v1/current.json?key=" + apiKey + "&q=";

                                const searchBox = document.querySelector(".search input");
                                const searchBtn = document.querySelector(".search button");
                                const weatherIcon = document.querySelector(".weather-icon");
                                const loadingElement = document.querySelector(".loading");

                                // Function to fetch weather data
                                async function checkWeather(city) {
                                    try {
                                        loadingElement.style.display = "block";
                                        const response = await fetch(apiUrl + city + "&aqi=yes");

                                        if (!response.ok) {
                                            throw new Error("City not found or invalid API key");
                                        }

                                        const data = await response.json();
                                        console.log(data);

                                        document.querySelector(".city").innerHTML = data.location.name;
                                        document.querySelector(".temp").innerHTML = Math.round(data.current.temp_c) + "°C";
                                        document.querySelector(".humidity").innerHTML = data.current.humidity + "%";
                                        document.querySelector(".wind").innerHTML = data.current.wind_kph + " km/h";

                                        // Weather condition for icon
                                        const condition = data.current.condition.text.toLowerCase();

                                        if (condition.includes("cloud")) {
                                            weatherIcon.src = "images/clouds.png";
                                        } else if (condition.includes("clear")) {
                                            weatherIcon.src = "images/clear.png";
                                        } else if (condition.includes("rain")) {
                                            weatherIcon.src = "images/rain.png";
                                        } else if (condition.includes("drizzle")) {
                                            weatherIcon.src = "images/drizzle.png";
                                        } else if (condition.includes("mist") || condition.includes("fog")) {
                                            weatherIcon.src = "images/mist.png";
                                        } else {
                                            weatherIcon.src = "images/clear.png";
                                        }

                                        loadingElement.style.display = "none";

                                    } catch (error) {
                                        console.error("Error fetching weather:", error.message);
                                        loadingElement.style.display = "none";
                                        alert("Error: " + error.message);
                                    }
                                }

                                // Function to get user's location and fetch weather
                                function getLocationWeather() {
                                    loadingElement.style.display = "block";
                                    if (navigator.geolocation) {
                                        navigator.geolocation.getCurrentPosition(
                                            async (position) => {
                                                const { latitude, longitude } = position.coords;
                                                try {
                                                    const response = await fetch(`${apiUrl}${latitude},${longitude}&aqi=yes`);
                                                    const data = await response.json();
                                                    searchBox.value = data.location.name;
                                                    checkWeather(data.location.name);
                                                } catch (error) {
                                                    console.error("Error fetching weather by location:", error);
                                                    loadingElement.style.display = "none";
                                                    // Default to a popular city if location fails
                                                    checkWeather("London");
                                                }
                                            },
                                            (error) => {
                                                console.error("Geolocation error:", error);
                                                loadingElement.style.display = "none";
                                                // Default to a popular city if location is denied
                                                checkWeather("London");
                                            }
                                        );
                                    } else {
                                        console.log("Geolocation is not supported by this browser.");
                                        loadingElement.style.display = "none";
                                        // Default to a popular city if geolocation isn't supported
                                        checkWeather("London");
                                    }
                                }

                                // Event listener for search button
                                searchBtn.addEventListener("click", () => {
                                    const city = searchBox.value.trim();
                                    if (city !== "") {
                                        checkWeather(city);
                                    }
                                });

                                // Also allow search on Enter key
                                searchBox.addEventListener("keypress", (e) => {
                                    if (e.key === "Enter") {
                                        const city = searchBox.value.trim();
                                        if (city !== "") {
                                            checkWeather(city);
                                        }
                                    }
                                });

                                // Load weather for user's location when page loads
                                window.addEventListener("load", getLocationWeather);

                            </script>
                        </div>

                    </div>
                </div>
            </div>



            <%- include('../partials/_footer.ejs') %>
                <!-- plugins:js -->
                <script src="vendors/js/vendor.bundle.base.js"></script>
                <!-- endinject -->
                <!-- Plugin js for this page -->
                <script src="vendors/chart.js/Chart.min.js"></script>
                <script src="vendors/datatables.net/jquery.dataTables.js"></script>
                <script src="vendors/datatables.net-bs4/dataTables.bootstrap4.js"></script>
                <script src="js/dataTables.select.min.js"></script>

                <!-- End plugin js for this page -->
                <!-- inject:js -->
                <script src="js/off-canvas.js"></script>
                <script src="js/hoverable-collapse.js"></script>
                <script src="js/template.js"></script>
                <script src="js/settings.js"></script>
                <script src="js/todolist.js"></script>
                <!-- endinject -->
                <!-- Custom js for this page-->
                <script src="js/dashboard.js"></script>
                <script src="js/Chart.roundedBarCharts.js"></script>
                <!-- End custom js for this page-->
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
                <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

</body>

</html>