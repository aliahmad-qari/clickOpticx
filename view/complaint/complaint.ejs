<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Wallet</title>
  <!-- plugins:css -->
  <!-- plugins:css -->
  <link rel="stylesheet" href="vendors/feather/feather.css">
  <link rel="stylesheet" href="vendors\ti-icons\css\themify-icons.css">
  <link rel="stylesheet" href="vendors/css/vendor.bundle.base.css">
  <!-- endinject -->
  <!-- Plugin css for this page -->
  <link rel="stylesheet" href="vendors/datatables.net-bs4/dataTables.bootstrap4.css">
  <link rel="stylesheet" href="vendors\ti-icons\css\themify-icons.css">
  <link rel="stylesheet" type="text/css" href="js/select.dataTables.min.css">
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <link rel="stylesheet" href="css/vertical-layout-light/style.css">
  <!-- endinject -->
  <link rel="shortcut icon" href="images/favicon.png" />

  <!-- Material Design Icons CSS -->
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Global Theme Variables */
    :root {
      /* Brand Colors - Same for both themes */
      --primary-color: #4F46E5;
      --primary-dark: #3730A3;
      --primary-light: #8B5CF6;
      --secondary-color: #10B981;
      --secondary-dark: #059669;
      --accent-color: #F59E0B;
      --accent-dark: #D97706;
      --danger-color: #EF4444;
      --success-color: #22C55E;
      --warning-color: #F59E0B;
      --info-color: #3B82F6;

      /* Light Theme Colors */
      --bg-primary: #FFFFFF;
      --bg-secondary: #F8FAFC;
      --bg-tertiary: #F1F5F9;
      --text-primary: #1E293B;
      --text-secondary: #475569;
      --text-tertiary: #64748B;
      --border-primary: #E2E8F0;
      --border-secondary: #CBD5E1;
      --shadow-light: rgba(0, 0, 0, 0.1);
      --shadow-medium: rgba(0, 0, 0, 0.15);
      --shadow-heavy: rgba(0, 0, 0, 0.25);
      --card-bg: #FFFFFF;
      --navbar-bg: #FFFFFF;
      --sidebar-bg: #FFFFFF;

      /* Legacy support */
      --primary-purple: #8B5CF6;
      --success-soft: rgba(34, 197, 94, 0.1);
      --text-muted: #64748B;
      --white-80: rgba(255, 255, 255, 0.8);
      --white-50: rgba(255, 255, 255, 0.5);
    }

    /* Dark Theme Colors */
    [data-theme="dark"] {
      --bg-primary: #0F172A;
      --bg-secondary: #1E293B;
      --bg-tertiary: #334155;
      --text-primary: #F8FAFC;
      --text-secondary: #CBD5E1;
      --text-tertiary: #94A3B8;
      --border-primary: #334155;
      --border-secondary: #475569;
      --shadow-light: rgba(0, 0, 0, 0.3);
      --shadow-medium: rgba(0, 0, 0, 0.4);
      --shadow-heavy: rgba(0, 0, 0, 0.6);
      --card-bg: #1E293B;
      --navbar-bg: #0F172A;
      --sidebar-bg: #1E293B;

      /* Legacy support */
      --success-soft: rgba(34, 197, 94, 0.2);
      --text-muted: #94A3B8;
      --white-80: rgba(248, 250, 252, 0.8);
      --white-50: rgba(248, 250, 252, 0.5);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }

    body {
      background: var(--bg-secondary) !important;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: var(--text-primary) !important;
      line-height: 1.6;
    }

    .container-scroller {
      background: var(--bg-secondary) !important;
    }

    .page-body-wrapper {
      background: var(--bg-secondary) !important;
    }

    .main-panel {
      background: var(--bg-secondary) !important;
    }

    .content-wrapper {
      background: var(--bg-secondary) !important;
    }

    .wallet-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 14px;
      color: white;
      box-shadow: 0 10px 20px rgba(118, 75, 162, 0.15);
      position: relative;
      overflow: hidden;
    }

    .wallet-card::before {
      content: "";
      position: absolute;
      top: -50%;
      right: -50%;
      width: 100%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
      transform: rotate(30deg);
    }

    .balance {
      font-size: 2.5rem;
      font-weight: 700;
      letter-spacing: 0.5px;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .price-card {
      background: var(--card-bg) !important;
      border: 1px solid var(--border-primary) !important;
      border-radius: 12px;
      box-shadow: 0 4px 12px var(--shadow-light);
      transition: all 0.3s ease;
      color: var(--text-primary) !important;
    }

    .price-card:hover {
      box-shadow: 0 8px 16px var(--shadow-medium);
      transform: translateY(-2px);
    }

    /* Dark theme card styling */
    [data-theme="dark"] .card {
      background: var(--card-bg) !important;
      border: 1px solid var(--border-primary) !important;
      color: var(--text-primary) !important;
    }

    [data-theme="dark"] .card-body {
      background: var(--card-bg) !important;
      color: var(--text-primary) !important;
    }

    [data-theme="dark"] .card-header {
      background: var(--bg-tertiary) !important;
      border-bottom: 1px solid var(--border-primary) !important;
      color: var(--text-primary) !important;
    }

    /* Form elements dark theme */
    [data-theme="dark"] .form-control {
      background: var(--bg-tertiary) !important;
      border: 1px solid var(--border-primary) !important;
      color: var(--text-primary) !important;
    }

    [data-theme="dark"] .form-control:focus {
      background: var(--bg-tertiary) !important;
      border-color: var(--primary-color) !important;
      color: var(--text-primary) !important;
      box-shadow: 0 0 0 0.2rem rgba(79, 70, 229, 0.25) !important;
    }

    /* Button styling */
    [data-theme="dark"] .btn-outline-primary {
      border-color: var(--primary-color) !important;
      color: var(--primary-color) !important;
    }

    [data-theme="dark"] .btn-outline-primary:hover {
      background: var(--primary-color) !important;
      color: white !important;
    }

    .task-card {
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
    }

    .task-card:hover {
      border-left-color: var(--primary-purple);
      transform: translateX(4px);
    }

    .task-image-wrapper {
      position: relative;
      width: 60px;
      height: 60px;
    }

    .task-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 8px;
    }

    .task-badge {
      position: absolute;
      top: -6px;
      right: -6px;
      background: #ff4757;
      color: white;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 10px;
      font-weight: bold;
    }

    .btn-wallet {
      background: rgba(255, 255, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.25);
      color: white;
      border-radius: 8px;
      backdrop-filter: blur(5px);
      transition: all 0.3s ease;
    }

    .btn-wallet:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-1px);
    }

    .progress-thin {
      height: 6px;
      border-radius: 3px;
    }

    .text-primary-dark {
      color: var(--primary-dark);
    }

    .text-purple {
      color: var(--primary-purple);
    }

    .bg-success-soft {
      background-color: var(--success-soft);
    }

    .text-white-80 {
      color: var(--white-80);
    }

    .text-white-50 {
      color: var(--white-50);
    }

    .hover-lift:hover {
      transform: translateY(-3px);
    }

    .external-link-icon {
      font-size: 0.8em;
      opacity: 0.7;
    }




    .file-upload-label:hover {
      border-color: #667eea !important;
      background-color: #f8f9fa;
    }

    .form-control:focus {
      border-color: #764ba2;
      box-shadow: 0 0 0 0.25rem rgba(118, 75, 162, 0.25);
    }

    .btn-primary:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .rounded-pill {
      transition: all 0.3s ease;
    }
  </style>

</head>

<body>
  <div class="container-scroller">

    <%- include ('../partials/_navbar.ejs') %>
      <!-- partial -->
      <div class="container-fluid page-body-wrapper" style="padding-left: 0 !important; padding-right: 0 !important;">
        <!-- partial:partials/_settings-panel.html -->
        <%- include ('../partials/SettingsDow.ejs') %>

          <!-- partial:partials/_sidebar.html Start-->
          <%- include ('../partials/Sidebar.ejs') %>
          <!-- partial:partials/_sidebar.html End -->

          <!-- Main Card -->
          <div class="container px-0">
            <% if (typeof messages !=='undefined' && messages.success && messages.success.length> 0) { %>
              <div class="position-relative" style="z-index: 1055;">
                <div class="d-flex justify-content-end position-absolute w-100"
                  style="top: 10px; right: 0; z-index: 1055;">
                  <div id="pusher-message-box" class="alert alert-success alert-dismissible fade show mt-3" role="alert"
                    style="color: white;">
                    <strong>Success:</strong>
                    <%= messages.success[0] %>
                  </div>
                </div>
              </div>
              <% } %>
                <div class="row mb-4">
                  <div class="col-12 px-0">
                    <div class="wallet-card p-4 mb-3 position-relative overflow-hidden">
                      <!-- Decorative elements -->
                      <div class="position-absolute top-0 end-0 wallet-decoration"></div>
                      <div class="d-flex justify-content-between align-items-start position-relative">
                        <div>
                          <h5 class="mb-1 text-white-80">Your Balance</h5>
                          <% task.map((task)=>{ %>
                            <div class="balance mb-2">PKR <%= task.coin_balance %>
                            </div>
                            <% }) %>
                              <small class="text-white-50 opacity-75">Updated just now</small>
                        </div>
                        <i class="bi bi-wallet2 fs-1 text-white-50"></i>
                      </div>
                      <div class="d-flex gap-2 mt-3 position-relative">
                        <button class="btn btn-wallet flex-grow-1 d-flex align-items-center justify-content-center"
                          data-bs-toggle="modal" data-bs-target="#submitTaskModal">
                          <i class="bi bi-cloud-upload me-2"></i>Submit Your Task
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Upgrade Package Section -->
                <div class="row mb-4">
                  <div class="col-12">
                    <div class="d-flex align-items-center mb-3">
                      <h5 class="mb-0 text-primary-dark">Upgrade Your Package</h5>
                      <span class="badge bg-warning ms-2">Special Offer</span>
                    </div>
                    <div class="price-card p-4 position-relative">
                      <div class="d-flex justify-content-between align-items-center">
                        <div>
                          <h6 class="mb-1 fw-semibold">Enhance Your Current Plan</h6>
                          <small class="text-muted">Complete assigned tasks to earn exclusive discounts on your
                            subscription.</small>
                        </div>
                        <i class="bi bi-gem fs-4 text-purple"></i>
                      </div>
                      <button 
                        class="btn btn-success w-100 mt-3 rounded-pill py-2 fw-medium shadow-sm d-flex align-items-center justify-content-center">
                        <i class="bi bi-currency-exchange me-2"></i><a href="/package" style="color: white; text-decoration: none;">Apply Available Balance</a>
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Daily Tasks Section -->
                <div class="row">
                  <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                      <h5 class="text-primary-dark mb-0">Today's Tasks</h5>
                      <div>
                        <small class="text-muted me-2">
                          <%= tasks.length %> tasks available
                        </small>
                        <i class="bi bi-info-circle" data-bs-toggle="tooltip"
                          title="Complete tasks to earn rewards"></i>
                      </div>
                    </div>

                    <% if (tasks.length===0) { %>
                      <div class="price-card p-4 text-center">
                        <i class="bi bi-inbox fs-1 text-muted mb-2"></i>
                        <h6 class="mb-1">No tasks available</h6>
                        <p class="text-muted small mb-0">Check back later for new tasks</p>
                      </div>
                      <% } else { %>
                        <% tasks.forEach(task=> { %>
                          <a href="<%= task.link %>" class="text-decoration-none task-link">
                            <div class="price-card p-3 mb-3 task-card hover-lift transition-all">
                              <div class="d-flex align-items-start gap-3">
                                <div class="task-image-wrapper flex-shrink-0">
                                  <img src="/uploads/<%= task.image %>" alt="Task Image" class="task-image rounded-2">
                                  <div class="task-badge bg-primary">New</div>
                                </div>
                                <div class="flex-grow-1">
                                  <div class="d-flex justify-content-between align-items-start">
                                    <h6 class="mb-1 task-title fw-medium">
                                      <%= task.title %>
                                    </h6>
                                    <div>
                                      <i class="fas fa-external-link-alt external-link-icon text-muted"></i>
                                      <span class="badge bg-success-soft text-success ms-2">
                                        <%= task.reward %> coins
                                      </span>
                                    </div>
                                  </div>
                                  <p class="text-muted small mb-2">
                                    <%= task.paragraph %>
                                  </p>
                                  <div class="d-flex justify-content-between align-items-center">
                                    <div class="d-flex align-items-center flex-grow-1 me-3">
                                      <i class="bi bi-clock-history text-muted me-2 small"></i>
                                      <small class="text-muted">
                                        <%= task.time_estimate %> min
                                      </small>
                                    </div>
                                    <span class="badge bg-success-soft text-success">
                                      <i class="bi bi-check-circle me-1"></i> Active
                                    </span>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </a>
                          <% }) %>
                            <% } %>
                  </div>
                </div>
          </div>



      </div>
  </div>

  <!-- Modal for Submitting Task -->
  <!-- Modal for Submitting Task -->
  <form action="/upload-task" method="POST" enctype="multipart/form-data">
    <div class="modal fade" id="submitTaskModal" tabindex="-1" aria-labelledby="submitTaskModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content shadow-lg" style="border: none; border-radius: 12px; overflow: hidden;">

          <!-- Modal Header with Gradient Background -->
          <div class="modal-header text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <h5 class="modal-title fs-5 fw-semibold" id="submitTaskModalLabel">
              <i class="bi bi-cloud-upload me-2"></i>Submit New Task
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

          <!-- Modal Body -->
          <div class="modal-body px-4 py-4">
            <!-- Hidden Fields using EJS -->
            <input type="hidden" id="hiddenId" name="id" value="<%= user.id %>">
            <input type="hidden" id="hiddenName" name="name" value="<%= user.Username %>">

            <!-- Task Title -->
            <div class="mb-4">
              <label for="taskTitle" class="form-label fw-medium text-secondary">Task Title</label>
              <div class="input-group">
                <span class="input-group-text bg-light">
                  <i class="bi bi-card-heading text-primary"></i>
                </span>
                <input type="text" class="form-control border-start-0 ps-3 py-2" id="taskTitle" name="title"
                  placeholder="Enter task title" required style="border-color: #e0e0e0; border-radius: 0 8px 8px 0;">
              </div>
            </div>

            <!-- Image Upload with Preview -->
            <div class="mb-3">
              <label for="taskImage" class="form-label fw-medium text-secondary">Upload Image</label>
              <div class="file-upload-wrapper">
                <input type="file" class="form-control visually-hidden" id="taskImage" name="images" accept="image/*"
                  required>
                <label for="taskImage"
                  class="file-upload-label d-flex flex-column align-items-center justify-content-center p-4"
                  style="border: 2px dashed #c4c4c4; border-radius: 8px; cursor: pointer; transition: all 0.3s;">
                  <i class="bi bi-cloud-arrow-up fs-1 text-muted mb-2"></i>
                  <span class="text-center text-muted">Click to upload or drag and drop</span>
                  <small class="text-muted mt-1">PNG, JPG (Max. 5MB)</small>
                </label>
                <div id="imagePreview" class="mt-3 text-center d-none">
                  <img src="#" alt="Preview" class="img-thumbnail" style="max-height: 150px; border-radius: 6px;">
                </div>
              </div>
            </div>
          </div>

          <!-- Modal Footer -->
          <div class="modal-footer bg-light px-4 py-3">
            <button type="button" class="btn btn-outline-secondary rounded-pill px-4"
              data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary rounded-pill px-4 fw-medium shadow-sm"
              style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
              <i class="bi bi-send-check me-2"></i>Submit Task
            </button>
          </div>
        </div>
      </div>
    </div>
  </form>


  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const msgBox = document.getElementById('pusher-message-box');
      if (msgBox) {
        setTimeout(() => {
          msgBox.classList.remove('show');
          msgBox.classList.add('fade');
          setTimeout(() => msgBox.style.display = "none", 500);
        }, 4000);
      }
    });
  </script>
  <!-- Add this JavaScript for image preview functionality -->
  <script>
    document.getElementById('taskImage').addEventListener('change', function (e) {
      const preview = document.getElementById('imagePreview');
      const previewImg = preview.querySelector('img');

      if (this.files && this.files[0]) {
        const reader = new FileReader();

        reader.onload = function (e) {
          previewImg.src = e.target.result;
          preview.classList.remove('d-none');
        }

        reader.readAsDataURL(this.files[0]);
      } else {
        preview.classList.add('d-none');
      }
    });
  </script>


  </div>



  <%- include('../partials/_footer.ejs') %>
    <!-- plugins:js -->
    <script src="vendors\js\vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="vendors\chart.js/Chart.min.js"></script>
    <script src="vendors/datatables.net/jquery.dataTables.js"></script>
    <script src="vendors/datatables.net-bs4/dataTables.bootstrap4.js"></script>
    <script src="js/dataTables.select.min.js"></script>

    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="js/off-canvas.js"></script>
    <script src="js/hoverable-collapse.js"></script>
    <script src="js/template.js"></script>
    <script src="js/settings.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page-->
    <script src="js/dashboard.js"></script>
    <script src="js/Chart.roundedBarCharts.js"></script>
    <!-- End custom js for this page-->
    <!-- Bootstrap  -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>